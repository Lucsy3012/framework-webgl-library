<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Solarsystem Simulation</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="author" content="Lucas Dietrich">
    <meta name="robots" content="index,follow">

    <meta property="og:title" content="Solarsystem Simulation | Explore our solarsystem virtually"/>
    <meta property="og:description" content="Space has always been a mystery to mankind. Its indescribable vastness and beauty are pleading for exploration."/>
    <meta property="og:image" content="img/og-images/og-image-solarsystem.jpg" />
    <meta property="og:type" content="website"/>
    <meta property="og:url" content="http://webgl.lucasdietrich.de/solarsystem.html"/>
    <meta property="og:site_name" content="Solarsystem Simulation | Explore our solarsystem virtually"/>

    <link rel="shortcut icon" href="img/favicons/solarsystem/favicon.ico">
    <link rel="icon" sizes="16x16 32x32 64x64" href="img/favicons/solarsystem/favicon.ico">
    <link rel="icon" type="image/png" sizes="16x16" href="img/favicons/solarsystem/favicon-16.png">
    <link rel="icon" type="image/png" sizes="32x32" href="img/favicons/solarsystem/favicon-32.png">
    <link rel="icon" type="image/png" sizes="64x64" href="img/favicons/solarsystem/favicon-64.png">
    <link rel="stylesheet" href="css/solarsystem.min.css">
</head>
<body>
    <div id="loader">
        <div class="container">
            <div class="loading-text-eyebrow">Welcome to the simulation</div>
            <div class="loading-text">Solarsystem</div>
            <div class="loading-text-instructions-holder">
                <div class="loading-text-instructions">
                    <p>
                        Use your mouse to zoom in/out and pan around them.
                        Use the top navigation to change planets.
                        You'll always be locked on to a planet.
                    </p>
                    <hr>
                    <dl>
                        <dt>Pan:</dt>
                        <dd>Press and hold mouse + move</dd>

                        <dt>Zoom in/out:</dt>
                        <dd>Mouse-Wheel up/down</dd>

                        <dt>Simulation controls:</dt>
                        <dd>Bottom-left corner</dd>

                        <dt>Music controls:</dt>
                        <dd>Bottom-right corner</dd>
                    </dl>
                </div>
            </div>
            <div id="start" tabindex="0">
                Press <kbd>Enter</kbd> or click here to start your exploration
            </div>
        </div>
    </div>

    <div class="story--holder" id="universe">
        <div id="canvas-container">
            <div id="cursor"></div>
            <div class="body-information">

                <!-- Sun -->
                <article id="sun-information">
                    <div class="title">Sun â˜‰</div>
                    <dl class="information">
                        <dt>Radius</dt><dd>696,342 km</dd>
                        <dt>Rotation tilt</dt><dd>7.25Â°</dd>
                        <dt>Rotation speed</dt><dd>25 days 6 hours</dd>
                    </dl>
                </article>

                <!-- Mercury -->
                <article id="mercury-information">
                    <div class="title">Mercury â˜¿</div>
                    <dl class="information">
                        <dt>Diameter</dt><dd>4,880 km</dd>
                        <dt>Rotation tilt</dt><dd>0.034Â°</dd>
                        <dt>Rotation speed</dt><dd>58 days 15 hours</dd>
                    </dl>
                    <hr>
                    <dl class="information">
                        <dt>Orbital radius</dt><dd>0.3871 AE</dd>
                        <dt>Orbital tilt</dt><dd>7.0049Â°</dd>
                        <dt>Orbital speed</dt><dd>~ 47.36 km/s</dd>
                    </dl>
                </article>

                <!-- Venus -->
                <article id="venus-information">
                    <div class="title">Venus â™€</div>
                    <dl class="information">
                        <dt>Diameter</dt><dd>12,103.6 km</dd>
                        <dt>Rotation tilt</dt><dd>177.36Â°</dd>
                        <dt>Rotation speed</dt><dd>243 days 36 minutes</dd>
                    </dl>
                    <hr>
                    <dl class="information">
                        <dt>Orbital radius</dt><dd>0.723 AE</dd>
                        <dt>Orbital tilt</dt><dd>8.3947Â°</dd>
                        <dt>Orbital speed</dt><dd>~ 35.02 km/s</dd>
                    </dl>
                </article>

                <!-- Earth -->
                <article id="earth-information">
                    <div class="title">Earth ðŸœ¨</div>
                    <dl class="information">
                        <dt>Diameter</dt><dd>12,756.27 km</dd>
                        <dt>Rotation tilt</dt><dd>23.44Â°</dd>
                        <dt>Rotation speed</dt><dd>23 hours 56 minutes</dd>
                    </dl>
                    <hr>
                    <dl class="information">
                        <dt>Orbital radius</dt><dd>1 AE</dd>
                        <dt>Orbital tilt</dt><dd>0.0001Â°</dd>
                        <dt>Orbital speed</dt><dd>~ 29.78 km/s</dd>
                    </dl>
                </article>

                <!-- Mars -->
                <article id="mars-information">
                    <div class="title">Mars â™‚</div>
                    <dl class="information">
                        <dt>Diameter</dt><dd>6,792.4 km</dd>
                        <dt>Rotation tilt</dt><dd>25.19Â°</dd>
                        <dt>Rotation speed</dt><dd>24 hours 37 minutes</dd>
                    </dl>
                    <hr>
                    <dl class="information">
                        <dt>Orbital radius</dt><dd>1,524 AE</dd>
                        <dt>Orbital tilt</dt><dd>1.8506Â°</dd>
                        <dt>Orbital speed</dt><dd>~ 24.07 km/s</dd>
                    </dl>
                </article>

                <!-- Jupiter -->
                <article id="jupiter-information">
                    <div class="title">Jupiter â™ƒ</div>
                    <dl class="information">
                        <dt>Diameter</dt><dd>142,984 km</dd>
                        <dt>Rotation tilt</dt><dd>3.13Â°</dd>
                        <dt>Rotation speed</dt><dd>9 hours 55 minutes</dd>
                    </dl>
                    <hr>
                    <dl class="information">
                        <dt>Orbital radius</dt><dd>5.204 AE</dd>
                        <dt>Orbital tilt</dt><dd>1.304Â°</dd>
                        <dt>Orbital speed</dt><dd>~ 13.06 km/s</dd>
                    </dl>
                </article>

                <!-- Saturn -->
                <article id="saturn-information">
                    <div class="title">Saturn â™„</div>
                    <dl class="information">
                        <dt>Diameter</dt><dd>120,536 km</dd>
                        <dt>Rotation tilt</dt><dd>26.73Â°</dd>
                        <dt>Rotation speed</dt><dd>10 hours 33 minutes</dd>
                    </dl>
                    <hr>
                    <dl class="information">
                        <dt>Orbital radius</dt><dd>9.582 AE</dd>
                        <dt>Orbital tilt</dt><dd>2.4845Â°</dd>
                        <dt>Orbital speed</dt><dd>~ 9.68 km/s</dd>
                    </dl>
                </article>

                <!-- Uranus -->
                <article id="uranus-information">
                    <div class="title">Uranus â›¢</div>
                    <dl class="information">
                        <dt>Diameter</dt><dd>51,118 km</dd>
                        <dt>Rotation tilt</dt><dd>97.77Â°</dd>
                        <dt>Rotation speed</dt><dd>17 hours 14 minutes</dd>
                    </dl>
                    <hr>
                    <dl class="information">
                        <dt>Orbital radius</dt><dd>19.201 AE</dd>
                        <dt>Orbital tilt</dt><dd>0.7699Â°</dd>
                        <dt>Orbital speed</dt><dd>~ 6.81 km/s</dd>
                    </dl>
                </article>

                <!-- Neptune -->
                <article id="neptune-information">
                    <div class="title">Neptune â™†</div>
                    <dl class="information">
                        <dt>Diameter</dt><dd>49,528 km</dd>
                        <dt>Rotation tilt</dt><dd>28.32Â°</dd>
                        <dt>Rotation speed</dt><dd>15 hours 58 minutes</dd>
                    </dl>
                    <hr>
                    <dl class="information">
                        <dt>Orbital radius</dt><dd>30.047 AE</dd>
                        <dt>Orbital tilt</dt><dd>1.7692Â°</dd>
                        <dt>Orbital speed</dt><dd>~ 5.43 km/s</dd>
                    </dl>
                </article>

                <!-- Pluto -->
                <article id="pluto-information">
                    <div class="title">Pluto â™‡</div>
                    <dl class="information">
                        <dt>Diameter</dt><dd>2,374 km</dd>
                        <dt>Rotation tilt</dt><dd>122.53Â°</dd>
                        <dt>Rotation speed</dt><dd>6 days 9 hours 43 minutes</dd>
                    </dl>
                    <hr>
                    <dl class="information">
                        <dt>Orbital radius</dt><dd>39.482 AE</dd>
                        <dt>Orbital tilt</dt><dd>17.1418Â°</dd>
                        <dt>Orbital speed</dt><dd>~ 4.67 km/s</dd>
                    </dl>
                </article>
            </div>

            <!-- UI -->
            <div class="ui-holder">

                <div class="controller panel" id="tweakpane"></div>

                <!-- Controller -->
                <div class="controller days-passed">
                    <div class="value" id="days">0</div>
                    <div class="title">Days passed</div>
                </div>
                <div class="controller simulation-speed">
                    <form id="simulation-speed-form">
                        <input class="value" id="simulation-speed" type="number" value="0.02" step="0.01" />
                        <label class="title" for="simulation-speed" style="display: block">Simulation speed</label>
                    </form>
                </div>

                <!-- Navigators -->
                <div class="navigator-holder">

                    <!-- Navigator left -->
                    <div class="navigator">
                        <nav id="navigate-to">
                            <ul>
                                <li class="sun" data-body="sun"></li>
                                <li class="mercury" data-body="mercury"></li>
                                <li class="venus" data-body="venus"></li>
                                <li class="earth" data-body="earth"></li>
                                <li class="mars active" data-body="mars"></li>
                                <li class="jupiter" data-body="jupiter"></li>
                                <li class="saturn" data-body="saturn"></li>
                                <li class="uranus" data-body="uranus"></li>
                                <li class="neptune" data-body="neptune"></li>
                                <li class="pluto" data-body="pluto"></li>
                            </ul>
                        </nav>
                        <div class="legend">Attach to</div>
                    </div>

                    <!-- Navigator right -->
                    <div class="navigator right">
                        <nav id="look-at">
                            <ul>
                                <li class="sun" data-body="sun"></li>
                                <li class="mercury" data-body="mercury"></li>
                                <li class="venus" data-body="venus"></li>
                                <li class="earth" data-body="earth"></li>
                                <li class="mars active" data-body="mars"></li>
                                <li class="jupiter" data-body="jupiter"></li>
                                <li class="saturn" data-body="saturn"></li>
                                <li class="uranus" data-body="uranus"></li>
                                <li class="neptune" data-body="neptune"></li>
                                <li class="pluto" data-body="pluto"></li>
                            </ul>
                        </nav>
                        <div class="legend">Look at</div>
                    </div>
                </div>

                <!-- Audioplayer -->
                <div class="audio-player">
                    <div class="title--holder">
                        <div class="title">Uncharted Worlds</div>
                    </div>
                    <div class="play-pause" title="Play / pause music">
                        <div class="bar"></div>
                        <div class="bar"></div>
                        <div class="bar"></div>
                    </div>
                    <div class="shuffle" id="shuffle" title="Shuffle to another song">
                        <img src="img/shuffle.svg" alt="Shuffle">
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="js/three.js"></script>
    <script src="js/tweakpane-3.1.1.min.js" type="text/javascript"></script>
    <script src="js/jquery-3.5.1.min.js" type="text/javascript"></script>

    <script type="module">

        // import * as THREE from './js/three.js';
        import { OrbitControls } from './js/OrbitControls.js';

        var container;
        var camera, scene, renderer, controls, loader;
        var mouse, raycaster;
        var framesCount = 0;

        var ambientLight, pointLight;

        let particles = [],
            particle, geometry, material, particleMap, spriteMaterial;
        
        let stars = [],
            starsGeometry, starsMaterial, starPositions, starColors;

        // Three Objects
        const clock = new THREE.Clock();

        // Math variables
        const pi2 = Math.PI * 2; // full rotation
        const deg = Math.PI / 180; // one degree
        const goldenAngle = Math.PI * (3 - Math.sqrt(5));


        // Math functions
        function easeInOut(x) {
            return Math.pow(Math.sin(x * Math.PI / 2), 2);
        }

        // Story variables
        let snapshotTime = 0;
        let snapshotCameraPosition = new THREE.Vector3();
        let snapshotCameraRotation = new THREE.Vector3();
        let previousTargetPosition = new THREE.Vector3();
        let storyTransition = false;
        let locked = true;
        let loaded = false;

        /*
         * Solarsystem Documentation
         *
         * AE in km
         * body['radius'] in km
         * body['distance'] in km * AE
         * body['speed'] in km/s
         * body['rotationSpeed'] compared times to earth
         * body['tilt'] in deg
         * orbital['tilt'] in deg
         *
        */

        // Objects
        let body, bodyGeometry, bodyMaterial, bodies = [], gBodies = [];
        let atmosphere, atmosphereGeometry, atmosphereMaterial, atmospheres = [];
        let rings, ringsGeometry, ringsMaterial;
        let orbit, orbitGeometry, orbitMaterial, orbits = [];

        // Simulation
        let simulationMode          = true;
        let elapsedTime             = 0;
        let deltaTime               = 0;
        let oldElapsedTime          = 0;
        let daysInSimulationPast    = 0;
        let simulationTime          = window.simulationTime = 0;
        let simulationSpeed         = window.simulationSpeed = 0.02; // 0,0027 = realtime
        const updateDateEvent       = new Event('updateDate');

        // User Params
        const queryString = window.location.search;
        const urlParams = new URLSearchParams(queryString);

        const paramsOptions = {
            highRes: urlParams.get('highRes') === 'true'
        }

        const pane = new Tweakpane.Pane({
            container: document.querySelector('#tweakpane'),
            title: 'Options',
            expanded: false,
            width: 150
        });

        const paneOptions = {
            showAtmosphere: true,
            showOrbits: false,
            highRes: paramsOptions.highRes,
            hideUI: false,
            toneMappingExposure: 1.1,
        }

        // Folders
        const paneFolderSolarsystem = pane.addFolder({ title: 'Solarsystem' });
        const paneFolderSimulationSpeed = pane.addFolder({ title: 'Simulation speed' });
        const paneFolderUI = pane.addFolder({ title: 'UI' });

        // Simulation
        paneFolderSolarsystem.addInput(paneOptions, 'showAtmosphere', { label: 'Show Atmosphere' }).on('change', () => {
            atmospheres.forEach((atmosphere) => {
                atmosphere.visible = paneOptions.showAtmosphere;
            });
        });
        paneFolderSolarsystem.addInput(paneOptions, 'showOrbits', { label: 'Show Orbits' }).on('change', () => {
            orbits.forEach((orbitGroup) => {
                orbitGroup.children[0].visible = paneOptions.showOrbits;
            });
        });
        paneFolderSolarsystem.addInput(paneOptions, 'highRes', { label: 'High-Res images (reloads)' }).on('change', () => {
            if (paneOptions.highRes === false) {
                window.location.href = window.location.origin + window.location.pathname;
            } else {
                window.location.href = window.location.origin + window.location.pathname + '?highRes=' + paneOptions.highRes;
            }
        });
        paneFolderSolarsystem.addInput(paneOptions, 'toneMappingExposure', { label: 'Tone Mapping Exposure', min: 0.75, max: 1.4 }).on('change', () => {
            renderer.toneMappingExposure = paneOptions.toneMappingExposure;
            renderer.render(scene, camera);
        });

        // Simulation Speed
        const paneSimulationSpeedRealTime = paneFolderSimulationSpeed.addButton({ title: 'Set to real-time' })
        const paneSimulationSpeedOneDay = paneFolderSimulationSpeed.addButton({ title: '1 Second = 1 Day' })
        const paneSimulationSpeedPause = paneFolderSimulationSpeed.addButton({ title: 'Pause' })
        const paneSimulationSpeedReset = paneFolderSimulationSpeed.addButton({ title: 'Reset' })

        paneSimulationSpeedRealTime.on('click', () => {
            window.simulationSpeed = 0.0027;
            document.querySelector('input#simulation-speed').value = window.simulationSpeed;
        });
        paneSimulationSpeedOneDay.on('click', () => {
            window.simulationSpeed = 1.0;
            document.querySelector('input#simulation-speed').value = window.simulationSpeed;
        });
        paneSimulationSpeedPause.on('click', () => {
            window.simulationSpeed = 0.0;
            document.querySelector('input#simulation-speed').value = window.simulationSpeed;
        });
        paneSimulationSpeedReset.on('click', () => {
            window.simulationSpeed = 0.02;
            document.querySelector('input#simulation-speed').value = window.simulationSpeed;
        });

        // UI
        const paneHideUI = paneFolderUI.addButton({ title: 'Hide UI (Press any key to show again)' })

        paneHideUI.on('click', () => {
            paneOptions.hideUI = !paneOptions.hideUI;
            document.querySelector('.ui-holder').classList.toggle('hidden', paneOptions.hideUI);
        });



        // Variables
        const AE    = 149597870;
        const km    = 1 / 1000;
        const year  = 365;
        const day   = 1 / year;
        const scale = 50;
        const solarsystem = {
            "sun": {
                "orbital": {
                    "tilt": 0
                },
                "body": {
                    // "radius": 696342.00,
                    "radius": 150000.00,
                    "distance": 0,
                    "speed": 0,
                    "rotationSpeed": 0.04,
                    "tilt": 7.25,
                    "color": "#ffbc76",
                    "map": "sun.jpg"
                }
            },
            "mercury": {
                "orbital": {
                    "tilt": 7.0049
                },
                "body": {
                    "radius": 4880.00,
                    "distance": 0.3871,
                    "speed": 47.36,
                    "rotationSpeed": 0.017,
                    "tilt": 0.034,
                    "color": "#e3d9c7",
                    "map": "mercury.jpg",
                    "normalMap": "mercury-normal.jpg"
                },
                "atmosphere": false
            },
            "venus": {
                "orbital": {
                    "tilt": 8.3947,
                },
                "body": {
                    "radius": 6501.65,
                    "distance": 0.723,
                    "speed": 35.02,
                    "rotationSpeed": 0.004,
                    "tilt": 177.36,
                    "color": "#eac9b0",
                    "map": "venus.jpg",
                    "normalMap": "venus-normal.jpg"
                },
                "atmosphere": {
                    "elevation": 1.025,
                    "opacity": 0.9,
                    "blending": 1,
                    "rotationMultiplicator": 120,
                    "map": "venus-atmosphere.jpg"
                }
            },
            "earth": {
                "orbital": {
                    "tilt": 0.0001,
                },
                "body": {
                    "radius": 6378.135,
                    "distance": 1,
                    "speed": 29.78,
                    "rotationSpeed": 1,
                    "tilt": 23.44,
                    "color": "#5f9bd9",
                    "map": "earth.jpg",
                    "normalMap": "earth-normal.jpg",
                },
                "atmosphere": {
                    "elevation": 1.0125,
                    "opacity": 1,
                    "blending": 2,
                    "rotationMultiplicator": 1.075,
                    "map": "earth-atmosphere.jpg",
                    "transparent": true
                }
            },
            "mars": {
                "orbital": {
                    "tilt": 1.8506,
                },
                "body": {
                    "radius": 3396.2,
                    "distance": 1.524,
                    "speed": 24.07,
                    "rotationSpeed": 0.999,
                    "tilt": 25.19,
                    "color": "#dd965f",
                    "map": "mars.jpg",
                    "normalMap": "mars-normal.jpg"
                },
                "atmosphere": {
                    "elevation": 1.0125
                }
            },
            "jupiter": {
                "orbital": {
                    "tilt": 1.304,
                },
                "body": {
                    "radius": 71492.0,
                    "distance": 5.204,
                    "speed": 13.06,
                    "rotationSpeed": 2.4,
                    "tilt": 3.13,
                    "color": "#e9c5a9",
                    "map": "jupiter.jpg"
                },
                "atmosphere": {
                    "elevation": 1.025
                }
            },
            "saturn": {
                "orbital": {
                    "tilt": 2.4845,
                },
                "body": {
                    "radius": 60268.0,
                    "distance": 9.582,
                    "speed": 9.68,
                    "rotationSpeed": 2.285,
                    "tilt": 26.73,
                    "color": "#e0c092",
                    "map": "saturn.jpg"
                },
                "atmosphere": {
                    "elevation": 1.025
                },
                "rings": {
                    // not real sizes,
                    "innerRadius": 67000,
                    "outerRadius": 160000,
                    "map": "saturn-rings.png"
                }
            },
            "uranus": {
                "orbital": {
                    "tilt": 0.7699,
                },
                "body": {
                    "radius": 25559.0,
                    "distance": 19.201,
                    "speed": 6.81,
                    "rotationSpeed": 1.411,
                    "tilt": 97.77,
                    "color": "#b8f3fc",
                    "map": "uranus.jpg"
                },
                "atmosphere": {
                    "elevation": 1.025
                }
            },
            "neptune": {
                "orbital": {
                    "tilt": 1.7692,
                },
                "body": {
                    "radius": 24764.0,
                    "distance": 30.047,
                    "speed": 5.43,
                    "rotationSpeed": 1.5,
                    "tilt": 28.32,
                    "color": "#4289c6",
                    "map": "neptune.jpg"
                },
                "atmosphere": {
                    "elevation": 1.025
                }
            },
            "pluto": {
                "orbital": {
                    "tilt": 17.1418,
                },
                "body": {
                    "radius": 1187.0,
                    "distance": 39.482,
                    "speed": 4.67,
                    "rotationSpeed": 0.166,
                    "tilt": 122.53,
                    "color": "#947c6c",
                    "map": "pluto.jpg",
                    "normalMap": "pluto-normal.jpg"
                },
                "atmosphere": {
                    "elevation": 1.025
                }
            }
        };

        init();
        sceneAnimation();

        // Initiating Scene
        function init() {

            // INIT Scene
            // --------------------------------------

            scene = new THREE.Scene();

            // INIT Camera
            // --------------------------------------

            camera = new THREE.PerspectiveCamera(50, window.innerWidth / window.innerHeight, 0.15, 500000);
            scene.add(camera);

            // INIT Renderer
            // --------------------------------------

            renderer = new THREE.WebGLRenderer({ antialias: true });
            renderer.setPixelRatio(window.devicePixelRatio);
            renderer.setSize(window.innerWidth, window.innerHeight);
            renderer.shadowMap.enabled = true;
            renderer.shadowMap.type = THREE.PCFSoftShadowMap;
            renderer.toneMapping = THREE.ACESFilmicToneMapping;
            renderer.toneMappingExposure = paneOptions.toneMappingExposure;

            container = document.getElementById('canvas-container');
            container.appendChild(renderer.domElement);

            raycaster = new THREE.Raycaster();
            mouse = new THREE.Vector2();

            // INIT Loader
            // --------------------------------------
            loader = new THREE.TextureLoader();

            // INIT Options
            // --------------------------------------

            // Lights
            addLights();

            // Controls
            addControls();

            // Create celestial bodies
            sceneCelestialBodies();

            // Create glow around sun
            sceneSunshine(solarsystem['sun']);

            // Create particles
            sceneStars();

            // Update renderer and camera when resizing
            window.addEventListener('resize', onWindowResize, false);
            window.addEventListener('mousemove', mouseVectoring, false);
            window.addEventListener('click', function() { intersectClick(bodies); }, false);

            // Grid
            // helperGrid();

            // INIT Story
            // --------------------------------------

            window.daysInSimulationPast = daysInSimulationPast;
            window.simulationNavigate = 'mars';
            window.simulationLookAt = 'mars';

            // Attach Trigger
            document.addEventListener('navigatorAttach', function() {
                storyTriggerRewrites();
            }, false);

            // Look At Trigger
            document.addEventListener('navigatorLookAt', function() {
                locked = false;
                controls.enableZoom = false;
                storyTriggerRewrites();
            }, false);

            // Rendered Trigger
            document.addEventListener('renderedObjects', function() {
                if (loaded === false) {
                    console.log('Get ready to explore our solarsystem!');
                    loaded = true;
                    $('body').addClass('loaded');

                    // randomize initial placement
                    for (let i = 0; i < orbits.length; ++i) {
                        orbits[i].rotation.y = THREE.MathUtils.randFloatSpread(180) * deg;
                    }

                    // Start at "Mars"
                    const startBody = bodies.filter(b => b.name === 'mars')

                    // Move to "Mars"
                    storyTriggerRewrites()

                    // Detach "Mars" after 4 seconds
                    setTimeout(function () {
                        $(`#navigate-to [data-body="${startBody[0].name}"]`).trigger('click');
                    }, 4000)
                }
            });
        }

        // Rendering the scene
        function sceneAnimation() {
            requestAnimationFrame(sceneAnimation);

            // Time
            elapsedTime = clock.getElapsedTime()
            deltaTime = elapsedTime - oldElapsedTime
            oldElapsedTime = elapsedTime

            scene.updateMatrixWorld();

            // Counting
            framesCount++;
            simulationTime += deltaTime * window.simulationSpeed
            window.simulationSpeedNormalized = deltaTime * window.simulationSpeed

            // if one second (times the simulation speed) has passed
            if (Math.floor(simulationTime) !== window.daysInSimulationPast) {

                // Update days count
                window.daysInSimulationPast = Math.floor(simulationTime);
                document.dispatchEvent(updateDateEvent);
            }

            /* Stars Animation
             * ------------------------------ */
            for (let i = 0; i < particles.length; ++i) {
                particles[i].material.opacity = (Math.sin((i + framesCount) * 0.02)) + 1.35;
            }

            /*
            for (let i = 0; i < starColors.length / 3; ++i) {
                const i3 = i * 3;
                const value = (Math.sin(i + elapsedTime)) + 1.35;

                stars.geometry.attributes.color[i3] = Math.abs(Math.sin(i + elapsedTime * 0.2));
                stars.geometry.attributes.color[i3 + 1] = Math.abs(Math.sin(i + elapsedTime * 0.2));
                stars.geometry.attributes.color[i3 + 2] = Math.abs(Math.sin(i + elapsedTime * 0.2));
                stars.geometry.attributes.color.needsUpdate = true;
            }
             */


            /* Single Orbit Animation
             * ------------------------------ */
            for (let i = 0; i < orbits.length; ++i) {
                let key = Object.keys(solarsystem)[i];
                let o = solarsystem[key];

                // If orbit around center exists
                if (o.body.distance > 0) {
                    let radius = o.body.distance * AE;
                    let circum = radius * Math.PI * 2;
                    let traveledPerDay = o.body.speed * 60 * 60 * 24;

                    orbits[i].rotation.x = solarsystem[key].orbital.tilt * deg;
                    orbits[i].rotation.y += (pi2 / circum * traveledPerDay) * window.simulationSpeedNormalized;
                }
            }

            /* Group Body Counter Rotation
             * so body isn't tidal locked
             * ------------------------------ */
            for (let i = 0; i < gBodies.length; ++i) {
                let key = Object.keys(solarsystem)[i];
                let o = solarsystem[key];

                if (i !== 0) {
                    let radius = o.body.distance * AE;
                    let circum = radius * Math.PI * 2;
                    let traveledPerDay = o.body.speed * 60 * 60 * 24;

                    gBodies[i].rotation.y -= (pi2 / circum * traveledPerDay) * window.simulationSpeedNormalized;
                }
            }

            /* Body Rotation
             * ------------------------------ */
            for (let i = 0; i < bodies.length; ++i) {
                let key = Object.keys(solarsystem)[i];
                let o = solarsystem[key];

                bodies[i].rotation.y += pi2 * o.body.rotationSpeed * window.simulationSpeedNormalized;

                // Atmosphere rotation
                if (atmospheres[i] && o.atmosphere.rotationMultiplicator) {
                    atmospheres[i].rotation.y += pi2 * o.body.rotationSpeed * window.simulationSpeedNormalized * o.atmosphere.rotationMultiplicator;
                }
            }

            /* Story Animations
             * ------------------------------ */
            if (storyTransition === true) {
                bodies.forEach(function(body) {
                    if (body.name === window.simulationNavigate) {
                        storyAnimateCameraPosition(body, snapshotTime, 4);
                    }
                    if (body.name === window.simulationLookAt) {
                        storyAnimateCameraRotation(body, snapshotTime, 4);
                    }
                });
            }

            renderer.render(scene, camera);
        }

        function addControls() {
            controls = new OrbitControls(camera, renderer.domElement);
            controls.screenSpacePanning = true;
            controls.panSpeed = 0.5;
            controls.minDistance = 0;
            controls.maxDistance = 4000000;
            controls.target.set(0, 0, 0);
            controls.update();
        }

        function sceneCelestialBodies() {
            const s = solarsystem;
            const sCount = Object.keys(s).length;

            for (let i = 0; i < sCount; i++) {

                /* Create groups
                 * ------------------------------ */
                let gOrbit = new THREE.Group();
                let gBody  = new THREE.Group();

                // Current body
                const key = Object.keys(s)[i];
                const o   = s[key];
                const distance = o.body.distance * AE * km / scale;
                const imageFolder = (simulationMode === true && paramsOptions.highRes.toString() === "true") ? 'img/highres/' : 'img/highres-compressed/';
                const bodyMap = loader.load(imageFolder + o.body.map);

                // Update Mipmapping Filter for crisp images
                if (simulationMode === true) {
                    bodyMap.minFilter = THREE.NearestMipmapNearestFilter;
                    bodyMap.magFilter = THREE.NearestFilter;
                }



                /* Create body
                 * ------------------------------ */
                if (key !== 'sun') {
                    bodyMaterial = new THREE.MeshPhongMaterial({map: bodyMap, color: o.body.color});
                    bodyMaterial.shininess = 0;
                } else {
                    bodyMaterial = new THREE.MeshBasicMaterial({map: bodyMap, color: o.body.color});
                }

                // Add normal map if available
                if (o.body.normalMap && paramsOptions.highRes.toString() === "true") {
                    bodyMaterial.normalMap = loader.load(imageFolder + o.body.normalMap);
                    bodyMaterial.normalScale = new THREE.Vector2(0.2, 0.2);
                    bodyMaterial.needsUpdate = true
                }

                bodyGeometry        = new THREE.SphereBufferGeometry(o.body.radius * km, 64, 64);
                body = bodies[i]    = new THREE.Mesh(bodyGeometry, bodyMaterial);

                // Tilt
                body.rotation.x = o.body.tilt * deg;

                // Add to local group
                body.name = key;
                gBody.add(body);



                /* Create atmosphere
                 * ------------------------------ */
                if (o.atmosphere) {
                    atmosphereGeometry  = new THREE.SphereBufferGeometry(o.body.radius * km * o.atmosphere.elevation, 64, 64);
                    atmosphereMaterial  = new THREE.MeshLambertMaterial({color: o.body.color, transparent: true});
                    atmosphere = atmospheres[i] = new THREE.Mesh(atmosphereGeometry, atmosphereMaterial);

                    // if has texture : add to material
                    if (o.atmosphere.map) {
                        atmosphere.material.color = new THREE.Color(0xbbbbbb);

                        if (o.atmosphere.transparent) {
                            atmosphere.material.alphaMap = loader.load(imageFolder + o.atmosphere.map);
                        } else {
                            atmosphere.material.map = loader.load(imageFolder + o.atmosphere.map);
                        }
                    }

                    // if simulation mode is activated
                    if (simulationMode === true) {

                        // apply real data if available
                        if (o.atmosphere.map && o.atmosphere.opacity && o.atmosphere.blending) {
                            atmosphere.material.blending = o.atmosphere.blending;
                            atmosphere.material.opacity = o.atmosphere.opacity;
                        } else {
                            atmosphere.material.blending = 2;
                            atmosphere.material.opacity = 0.15;
                        }
                    } else {
                        atmosphere.material.blending = 2;
                        atmosphere.material.opacity = 1;
                    }

                    // Tilt
                    atmosphere.rotation.x = o.body.tilt * deg;
                    atmosphere.visible = paneOptions.showAtmosphere

                    // Name and add to local group
                    atmosphere.name = key + '-atmosphere';
                    gBody.add(atmosphere);
                }



                /* Create rings
                 * ------------------------------ */
                if (o.rings) {
                    ringsGeometry   = new THREE.RingBufferGeometry(o.rings.innerRadius * km, o.rings.outerRadius * km, 64, 64);
                    ringsMaterial   = new THREE.MeshLambertMaterial({map: loader.load('img/' + o.rings.map), transparent: true, side: THREE.DoubleSide});
                    rings           = new THREE.Mesh(ringsGeometry, ringsMaterial);

                    // Tilt
                    rings.rotation.x = (o.body.tilt + 90) * deg;

                    // Name and add to local group
                    rings.name = key + '-rings';
                    gBody.add(rings);
                }



                /* Create orbit
                 * ------------------------------ */
                if (o.orbital) {
                    orbitGeometry   = new THREE.TorusBufferGeometry(distance, 0.1, 64, Math.round(distance / 10));
                    // orbitMaterial   = new THREE.MeshBasicMaterial({color: 0xffffff, transparent: true, opacity: 0.33});
                    orbitMaterial   = new THREE.LineBasicMaterial({color: 0xffffff, linewidth: 1});
                    orbit           = new THREE.Mesh(orbitGeometry, orbitMaterial);

                    orbit.rotation.x = 90 * deg;
                    orbit.name = key + '-orbit-ring';
                    orbit.visible = paneOptions.showOrbits
                }



                /* Refine body group
                 * ------------------------------ */
                gBody.name = key + '-group';
                gBody.position.x = distance; // distance from center
                gBody.rotation.x = o.body.tilt * deg; // tilt towards center
                gBody.rotation.y = THREE.MathUtils.randFloatSpread(180) * deg; // randomize inital rotation
                gBodies[i] = gBody;



                /* Define orbit group
                 * ------------------------------ */
                gOrbit.name = key + '-orbit';
                // gOrbit.rotation.y = THREE.MathUtils.randFloatSpread(180) * deg; // randomize initial placement
                gOrbit.add(orbit);
                gOrbit.add(gBody);
                orbits[i] = gOrbit;

                // Add orbit group to solarsystem group and scene
                scene.add(gOrbit);
            }
        }

        function sceneSunshine(obj) {
            var sunshineMap       = new THREE.TextureLoader().load("img/sunshine_sprite.svg");
            var sunshineMaterial  = new THREE.SpriteMaterial({ map: sunshineMap });
            var sunshine          = new THREE.Sprite(sunshineMaterial);
            sunshine.scale.x = obj.body.radius / 333;
            sunshine.scale.y = obj.body.radius / 333;
            sunshine.scale.z = obj.body.radius / 333;
            sunshine.material.opacity = 0.66;
            scene.add(sunshine);
        }

        function sceneStars(isSprite = true, size = 24, length = 10000, minDistance = 85000, maxDistance = 400000) {
            
            // Init (based on points material)
            /*
            starsGeometry = new THREE.BufferGeometry();
            starsMaterial = new THREE.PointsMaterial({
                size,
                sizeAttenuation: true,
                depthWrite: false,
                blending: THREE.AdditiveBlending,
                map: new THREE.TextureLoader().load("img/star_sprite.svg"),
                vertexColors: true
            });

            starPositions = new Float32Array(length * 3);
            starColors = new Float32Array(length * 3);

            let colorSpectrum1 = new THREE.Color(0xff6030);
            let colorSpectrum2 = new THREE.Color(0x9cb1e2);
            let colorSpectrum3 = new THREE.Color(0xffffff);

            for (let i = 0; i < length; ++i) {
                const i3 = i * 3;
                const random = Math.random();
                console.log(random)
                
                // Positions (distribute randomly in space between minDistance and maxDistance)
                const x = i3
                const y = i3 + 1;
                const z = i3 + 2;
                const theta = goldenAngle * i3;

                 starPositions[x] = THREE.MathUtils.randFloat(minDistance, maxDistance) * THREE.MathUtils.randFloatSpread(2) * Math.sin(theta);
                 starPositions[y] = THREE.MathUtils.randFloat(minDistance, maxDistance) * THREE.MathUtils.randFloatSpread(2) * Math.cos(theta);
                 starPositions[z] = THREE.MathUtils.randFloat(minDistance, maxDistance) * THREE.MathUtils.randFloatSpread(2);

                // At least one coordinate needs min-distance
                if (random < 0.33) {
                    starPositions[x] = (starPositions[x] < 0) ? starPositions[x] - minDistance : starPositions[x] + minDistance;
                } else if (random < 0.66) {
                    starPositions[y] = (starPositions[y] < 0) ? starPositions[y] - minDistance : starPositions[y] + minDistance;
                } else {
                    starPositions[z] = (starPositions[z] < 0) ? starPositions[z] - minDistance : starPositions[z] + minDistance;
                }

                // Colors
                const colorSpectrum  = colorSpectrum1.clone();
                colorSpectrum.lerp(colorSpectrum2, random);
                colorSpectrum.lerp(colorSpectrum3, random + 0.33);

                starColors[i3]      = colorSpectrum.r;
                starColors[i3 + 1]  = colorSpectrum.g;
                starColors[i3 + 2]  = colorSpectrum.b;
            }
            
            starsGeometry.setAttribute('position', new THREE.BufferAttribute(starPositions, 3));
            starsGeometry.setAttribute('color', new THREE.BufferAttribute(starColors, 3));

            stars = new THREE.Points(starsGeometry, starsMaterial);
            scene.add(stars);
            */

            // Init (based on individual spheres)
            geometry    = new THREE.SphereBufferGeometry(size, 8, 8);
            particleMap = new THREE.TextureLoader().load("img/star_sprite.svg");

            let i = 0;

            for (i; i < length; ++i) {

                // Material
                let colorSpectrum1 = new THREE.Color(0xff6030);
                let colorSpectrum2 = new THREE.Color(0x9cb1e2);
                let colorSpectrum3 = new THREE.Color(0xffffff);

                const colorSpectrum  = colorSpectrum1.clone();
                colorSpectrum.lerp(colorSpectrum2, Math.random());
                colorSpectrum.lerp(colorSpectrum3, Math.random() + 0.33);

                spriteMaterial = new THREE.SpriteMaterial({ color: colorSpectrum, map: particleMap });
                particle = particles[i] = new THREE.Sprite(spriteMaterial);
                particle.scale.set(85, 85, 85);

                // Distribute randomly with space in the middle
                let theta = goldenAngle * i;

                particle.position.x = THREE.MathUtils.randFloat(minDistance, maxDistance) * THREE.MathUtils.randFloatSpread(2) * Math.sin(theta);
                particle.position.y = THREE.MathUtils.randFloat(minDistance, maxDistance) * THREE.MathUtils.randFloatSpread(2) * Math.cos(theta);
                particle.position.z = THREE.MathUtils.randFloat(minDistance, maxDistance) * THREE.MathUtils.randFloatSpread(2);

                // At least one coordinate needs min-distance
                if (Math.random() < 0.33) {
                    particle.position.x = (particle.position.x < 0) ? particle.position.x - minDistance : particle.position.x + minDistance;
                } else if (Math.random() < 0.66) {
                    particle.position.y = (particle.position.y < 0) ? particle.position.y - minDistance : particle.position.y + minDistance;
                } else {
                    particle.position.z = (particle.position.z < 0) ? particle.position.z - minDistance : particle.position.z + minDistance;
                }

                scene.add(particle);
            }
        }


        // Camera
        function onWindowResize() {
            camera.aspect = window.innerWidth / window.innerHeight;
            camera.updateProjectionMatrix();
            renderer.setSize(window.innerWidth, window.innerHeight);
        }

        // Lights
        function addLights() {
            ambientLight = new THREE.AmbientLight(0xffffff, 0);
            scene.add(ambientLight);

            pointLight = new THREE.PointLight(0xffffff, 0.85, 200000, 0.66);
            pointLight.position.set(0, 0, 0);
            pointLight.castShadow = true;
            pointLight.shadow.mapSize.width = 1024;
            pointLight.shadow.mapSize.height = 1024;
            scene.add(pointLight);
        }

        // Helpers
        function helperGrid() {
            var grid = new THREE.GridHelper(1000, 0);
            scene.add(grid);
        }

        
        // Raycasting (find intersecting elements)
        // -----------------------------------
        function mouseVectoring(e) {
            mouse.x = (e.clientX / window.innerWidth) * 2 - 1;
            mouse.y = - (e.clientY / window.innerHeight) * 2 + 1;
        }

        function rayCastingObjs(objs) {
            raycaster.setFromCamera(mouse, camera);
            return raycaster.intersectObjects(objs);
        }

        function intersectClick(objs) {
            var intersects = rayCastingObjs(objs);

            if (intersects.length > 0) {
                let clickBodyEvent = new CustomEvent('clickBody', { detail: { 'body': intersects[0].object.name } });
                document.dispatchEvent(clickBodyEvent);
            }
        }


        // Story

        // Get current status and write to story (general)
        function storyTriggerRewrites() {

            // Get current status on trigger
            storyTransition = true;
            snapshotTime = elapsedTime;
            previousTargetPosition = controls.target;
            snapshotCameraPosition.x = camera.position.x;
            snapshotCameraPosition.y = camera.position.y;
            snapshotCameraPosition.z = camera.position.z;
            snapshotCameraRotation.x = camera.rotation.x;
            snapshotCameraRotation.y = camera.rotation.y;
            snapshotCameraRotation.z = camera.rotation.z;
        }

        function storyAnimateCameraPosition(target, snapshotTime, duration) {
            let position = camera.position;
            let v = new THREE.Vector3();
            let t = target.getWorldPosition(v);
            let r = target.geometry.parameters.radius;

            // Approach 0 to 1 with ease-in-out function in y frames
            let x = (elapsedTime - snapshotTime) / duration;
            let progress = easeInOut(x);

            // Define multiplications for elevated view of body
            let multiplicator = new THREE.Vector3(2.5, 0, 5);

            // Get if position is positive or negative
            let elevation = new THREE.Vector3();
            elevation.x = (position.x > 0) ? 1 : -1;
            elevation.y = 1;
            elevation.z = (position.z > 0) ? -1 : 1;

            // Attach if progress is completed
            if (x >= 1) {
                position.x = t.x + (elevation.x * r * multiplicator.x);
                position.y = t.y + (elevation.y * r * multiplicator.y);
                position.z = t.z + (elevation.z * r * multiplicator.z);
            } else {
                position.x = snapshotCameraPosition.x + ((t.x + (elevation.x * r * multiplicator.x) - snapshotCameraPosition.x) * progress);
                position.y = snapshotCameraPosition.y + ((t.y + (elevation.y * r * multiplicator.y) - snapshotCameraPosition.y) * progress);
                position.z = snapshotCameraPosition.z + ((t.z + (elevation.z * r * multiplicator.z) - snapshotCameraPosition.z) * progress);
            }
        }

        function storyAnimateCameraRotation(target, snapshotTime, duration) {
            let position = camera.position;
            let v = new THREE.Vector3();
            let t = target.getWorldPosition(v);
            let r = target.geometry.parameters.radius;

            // Approach 0 to 1 with ease-in-out function in y frames
            let x = (elapsedTime - snapshotTime) / duration;
            let progress = easeInOut(x);

            // Define multiplications for elevated view of body
            const multiplicator = new THREE.Vector3(2.5, 0, 5);

            // Get if position is positive or negative
            let elevation = new THREE.Vector3();
            elevation.x = (position.x > 0) ? 1 : -1;
            elevation.y = 1;
            elevation.z = (position.z > 0) ? -1 : 1;

            // Lock if progress is completed
            if (locked === true) {
                camera.lookAt(t);

                // Always lock controls to fixated body
                controls.enableZoom = true;
                controls.target.set(t.x, t.y, t.z);
            } else {

                // Set to "locked"
                if (x >= 0.66) {
                    locked = true;
                    controls.enableZoom = true

                // Slowly look at body
                } else {

                    // Camera Rotation
                    camera.lookAt(
                        THREE.MathUtils.lerp(previousTargetPosition.x, t.x, progress),
                        THREE.MathUtils.lerp(previousTargetPosition.y, t.y, progress),
                        THREE.MathUtils.lerp(previousTargetPosition.z, t.z, progress),
                    );

                    /* todo For manual positioning (optimize progress first because it stutters in combination with the lookAt function)
                    // Camera Position
                    if (window.simulationNavigate === '') {
                        camera.position.x = snapshotCameraPosition.x + ((t.x + (elevation.x * r * multiplicator.x) - snapshotCameraPosition.x) * progress);
                        camera.position.y = snapshotCameraPosition.y + ((t.y + (elevation.y * r * multiplicator.y) - snapshotCameraPosition.y) * progress);
                        camera.position.z = snapshotCameraPosition.z + ((t.z + (elevation.z * r * multiplicator.z) - snapshotCameraPosition.z) * progress);
                    }
                     */
                }
            }
        }

    </script>

    <script>

        $(document).ready(function() {
            const $body         = $('body');

            // Audioplayer
            // ----------------------------------

            const $audioPlayer  = $('.audio-player');
            const $titleHolder  = $('.audio-player .title--holder');
            const $play         = $('.audio-player .play-pause');
            const songs         = [
                {
                    "name": "Mass Effect - Uncharted Worlds",
                    "file": "audio/mass_effect_uncharted_worlds.mp3"
                },
                {
                    "name": "Mass Effect Andromeda - Galaxy Map",
                    "file": "audio/mass_effect_andromeda_galaxy_map.mp3"
                },
                {
                    "name": "Sarah, The Illstrumentalist - Stars and Constellations",
                    "file": "audio/sarah_the_illstrumentalist_stars_and_constellations.mp3"
                },
                {
                    "name": "Endless Space - The Endless",
                    "file": "audio/endless_space_the_endless.mp3"
                },
                {
                    "name": "Endless Space - TransX",
                    "file": "audio/endless_space_transx.mp3"
                },
                {
                    "name": "Endless Space - B.Matter",
                    "file": "audio/endless_space_bmatter.mp3"
                },
                {
                    "name": "Endless Space - Falling Night Stars",
                    "file": "audio/endless_space_falling_night_stars.mp3"
                },
                {
                    "name": "Metroid Prime 2 - Submerged Temple",
                    "file": "audio/metroid_prime_2_submerged_temple.mp3"
                },
                {
                    "name": "Metroid Prime 3 - Skytown",
                    "file": "audio/metroid_prime_3_skytown.mp3"
                },
                {
                    "name": "Perturbator - Last Kiss",
                    "file": "audio/perturbator_last_kiss.mp3"
                },
                {
                    "name": "Perturbator - The Price Of Failure",
                    "file": "audio/perturbator_the_price_of_failure.mp3"
                },
                {
                    "name": "Oliver Patrice Weder - Minutes and Hours",
                    "file": "audio/oliver_patrice_weder_minutes_and_hours.mp3"
                },
                {
                    "name": "Interstellar - Message From Home",
                    "file": "audio/interstellar_message_from_home.mp3"
                },
                {
                    "name": "Interstellar - Cornfield Chase",
                    "file": "audio/interstellar_cornfield_chase.mp3"
                },
                {
                    "name": "Bonjr - It's Ok, You're Ok",
                    "file": "audio/bonjr_its_ok_youre_ok.mp3"
                },
                {
                    "name": "Animal Crossing - 1AM",
                    "file": "audio/animal_crossing_1am.mp3"
                },
                {
                    "name": "DARK - Ich Dachte, Ich Haette Mehr Zeit",
                    "file": "audio/dark_ich_dachte_ich_haette_mehr_zeit.mp3"
                },
                {
                    "name": "Guild Wars - Droknar's Forge",
                    "file": "audio/guild_wars_droknars_forge.mp3"
                },
                {
                    "name": "Skyrim - Kyne's Peace",
                    "file": "audio/skyrim_kynes_peace.mp3"
                }
            ];

            // Shuffle
            generateAudio(false);

            $('#shuffle').on('click', function() {
                generateAudio(true);
                playAudio();
            });

            function generateAudio(autoplay) {
                const songsCount = songs.length;
                const songsIndex = Math.floor(Math.random() * songsCount);
                const randomSong = songs[songsIndex];
                const name = randomSong.name;
                const file = randomSong.file;
                let audioElement;

                if (autoplay) {
                    audioElement = '<audio controls autoplay loop id="audio">' +
                        '<source src="' + file + '" type="audio/mpeg">' +
                    '</audio>';
                } else {
                    audioElement = '<audio controls loop id="audio">' +
                        '<source src="' + file + '" type="audio/mpeg">' +
                    '</audio>';
                }

                // Remove old audio & append new
                $titleHolder.find('.title').text(name);
                $body.find('audio').remove();
                $body.append(audioElement);
                document.getElementById('audio').volume = 0.2;
            }


            $play.on('click', function() {
                playPause();
            });

            $(window).on('keydown', function(e) {
                if (e.keyCode === 32 || e.key === ' ') {
                    playPause();
                }
            });

            function playAudio() {
                $audioPlayer.addClass('sound-on');
                $body.find('audio').trigger('play');
            }

            function pauseAudio() {
                $audioPlayer.removeClass('sound-on');
                $body.find('audio').trigger('pause');
            }

            function playPause() {
                let soundOn = $audioPlayer.hasClass('sound-on');

                if (!soundOn) {
                    playAudio();
                } else {
                    pauseAudio();
                }
            }



            // Reveal scene when user clicks
            // ----------------------------------

            const renderedObjectsEvent = new Event('renderedObjects');

            document.getElementById('start').addEventListener('click', function() {
                document.dispatchEvent(renderedObjectsEvent);
                playPause();
            });

            window.addEventListener('keydown', function(e) {
                if (e.code === 'Enter') {
                    document.dispatchEvent(renderedObjectsEvent);
                    playPause();
                }
            })



            // Simulation
            // ----------------------------------

            document.addEventListener('updateDate', updateDate, false);

            const $daysPast = $('#days');
            const $simulationSpeedForm = $('#simulation-speed-form');
            const $simulationSpeed = $('#simulation-speed');

            function updateDate() {
                $daysPast.text(window.daysInSimulationPast);
            }

            $simulationSpeedForm.on('submit', function(e) {
                e.preventDefault();
                window.simulationSpeed = $simulationSpeed.val();
            });

            $simulationSpeed.on('change keydown keyup', function() {
                window.simulationSpeed = $(this).val();
            });



            // UI
            // ----------------------------------
            const $uiHolder = $('.ui-holder');

            $(window).on('keydown', function() {
                $uiHolder.toggleClass('hidden', false);
            });


            const $cursor   = $('#cursor');

            $(window).on('mousemove', function(e) {
                placeCursor(e);
            });

            function placeCursor(e) {
                $cursor.css('transform', `translate(calc(${e.pageX}px - 50%), calc(${e.pageY}px - 50%))`);
                $cursor.css('opacity', 1);
            }



            // Navigator
            // ----------------------------------

            const navigatorAttachEvent = new Event('navigatorAttach');
            const navigatorDetachEvent = new Event('navigatorDetach');
            const navigatorLookAtEvent = new Event('navigatorLookAt');
            const $navigateItem = $('#navigate-to li');
            const $lookAtItem = $('#look-at li');

            $navigateItem.on('click', function() {
                const $this = $(this);

                // Detach
                if ($this.hasClass('active')) {
                    storyTransition = false;
                    $navigateItem.removeClass('active');
                    window.simulationNavigate = '';
                    document.dispatchEvent(navigatorDetachEvent);

                // Attach
                } else {
                    $navigateItem.removeClass('active');
                    $this.addClass('active');
                    window.simulationNavigate = $this.attr('data-body');
                    document.dispatchEvent(navigatorAttachEvent);
                }
            });

            $lookAtItem.on('click', function() {
                const $this = $(this);

                $lookAtItem.removeClass('active');
                $this.addClass('active');
                window.simulationLookAt = $this.attr('data-body');
                document.dispatchEvent(navigatorLookAtEvent);
            });



            // Body information
            // ----------------------------------

            const $bodyInformation = $('.body-information');
            let $bodyInformations = $bodyInformation.find('article');

            document.addEventListener('click', hideBodyInformation, false);
            document.addEventListener('clickBody', function(e) { showBodyInformation(e) }, false);

            function showBodyInformation(e) {
                $bodyInformation.find('#' + e.detail.body + '-information').addClass('active');
            }

            function hideBodyInformation() {
                $bodyInformations.removeClass('active');
            }
        });
    </script>

</body>
</html>
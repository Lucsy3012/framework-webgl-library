<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <link rel="shortcut icon" href="img/favicon.ico">
    <title>Solarsystem</title>

    <style>
        * { user-select: none; }
        body { margin: 0; background-color: #000; font-family: 'Inter', sans-serif; }
        canvas { display: block; }
        canvas:focus { outline: none; }
        .story--holder {
            position: relative;
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            align-items: center;
            width: 100vw;
            height: 100vh;
            overflow: hidden;
        }
        #canvas-container {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            align-items: center;
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            width: 100vw;
            height: 100vh;
            z-index: 1;
            transition: all 2s cubic-bezier(0.67, 0.04, 0.18, 0.96);
            transition-delay: 0.25s;
        }

        .hide-ui {
            position: absolute;
            top: 0;
            right: 0;
            width: 7vmin;
            height: 7vmin;
            z-index: 1;
        }

        .ui-holder {
            position: absolute;
            top: 0;
            left: 0;
            width: 100vw;
            height: 100vh;
            transition: all 2s cubic-bezier(0.67, 0.04, 0.18, 0.96);
            pointer-events: none;
        }

        .ui-holder > * {
            pointer-events: initial;
        }

        .ui-holder.hidden {
            opacity: 0;
            transform: scale(1.4);
        }

        /* Controller
         ----------------------------------- */

        .controller {
            position: absolute;
            left: 70px;
            bottom: 70px;
            text-align: center;
            animation: controller 2s both ease;
            animation-delay: .5s;
            animation-direction: normal;
            animation-iteration-count: 1;
        }

        .controller .value {
            display: inline-block;
            width: auto;
            margin: 10px 0 0;
            font-family: 'Inter', sans-serif;
            font-size: 16px;
            font-weight: 200;
            text-align: center;
            outline: none;
            border: none;
            color: #ffffffdd;
            text-shadow: 0 0 6px #ffffffaa;
            background: none;
        }

        .controller input.value {
            width: 60px;
        }

        .controller .title {
            margin-top: 10px;
            font-size: 13px;
            font-weight: 300;
            letter-spacing: 0.02em;
            color: #ffffff77;
        }

        .controller.days-passed {
            left: 70px;
        }
        .controller.simulation-speed {
            left: 200px;
            padding-left: 46px;
            border-left: 1px solid #fff3;
        }

        /* Body information
         ----------------------------------- */
        .body-information {
            font-family: 'Inter', sans-serif;
        }

        .body-information article {
            position: absolute;
            left: 70px;
            top: 60px;
            transition: all .5s ease;
            opacity: 0;
            transform: translateX(-30px);
            pointer-events: none;
            touch-action: none;
        }

        .body-information article.active {
            opacity: 1;
            transform: translateX(0);
            pointer-events: initial;
            touch-action: initial;
        }

        .body-information .title {
            margin: 0 0 10px;
            color: #ffffff;
            text-shadow: 0 0 6px #ffffffaa;
            font-size: 13px;
            font-weight: 400;
            text-transform: uppercase;
            letter-spacing: 0.2em;
        }

        .body-information hr {
            border-width: 1px 0 0;
            border-color: #fff3;
        }

        .body-information dl {
            display: grid;
            grid-template-columns: 110px auto;
            grid-gap: 3px;
            margin-top: 10px;
            font-size: 12px;
            font-weight: 300;
            letter-spacing: 0.02em;
            color: #ffffff77;
        }

        .body-information dl dt,
        .body-information dl dd {
            display: inline-block;
            margin: 0;
        }

        .body-information dl dt::after {
            content: ":";
        }


        /* Navigation
         ----------------------------------- */

        .navigator {
            display: flex;
            gap: 20px;
            align-items: center;
            flex-direction: row-reverse;
            position: absolute;
            top: 66%;
            left: 70px;
            transform-origin: left;
            transform: rotate(-90deg);
            animation: navigatorLeft 2s both ease;
            animation-delay: .5s;
            animation-direction: normal;
            animation-iteration-count: 1;
        }

        .navigator ul {
            display: flex;
            gap: 10px;
            margin: 0;
            padding: 0;
            list-style: none;
            flex-direction: row-reverse;
        }

        .navigator li {
            position: relative;
            width: 10px;
            height: 10px;
            border-radius: 10px;
            border: 1px solid #ffffff55;
            cursor: pointer;
        }

        .navigator li::before {
            display: block;
            content: "";
            width: 4px;
            height: 4px;
            position: absolute;
            top: 3px;
            left: 3px;
            background-color: #fff;
            border-radius: 10px;
            transform: scale(.5);
            opacity: 0;
            transition: all .3s ease;
        }

        .navigator li::after {
            display: inline-block;
            width: 70px;
            font-family: 'Inter', sans-serif;
            font-size: 10px;
            padding: 5px 5px 5px 30px;
            font-weight: 400;
            color: #ffffff55;
            text-transform: uppercase;
            letter-spacing: 0.2em;
            opacity: 0;
            transform-origin: left;
            transform: translate(5px, -40px) rotate(90deg);
            transition: all .5s ease;
        }

        .navigator li:hover::before,
        .navigator li.active::before {
            transform: scale(1);
            opacity: 1;
        }

        .navigator li:hover::after {
            transform: translate(5px, -15px) rotate(90deg);
            opacity: 1;
        }

        /* Body specifics */
        .navigator li.sun::before           { background-color: #ffbc76; }
        .navigator li.sun::after            { content: "Sun"; }

        .navigator li.mercury::before       { background-color: #e3d9c7; }
        .navigator li.mercury::after        { content: "Mercury"; }

        .navigator li.venus::before         { background-color: #eac9b0; }
        .navigator li.venus::after          { content: "Venus"; }

        .navigator li.earth::before         { background-color: #5f9bd9; }
        .navigator li.earth::after          { content: "Earth"; }

        .navigator li.mars::before          { background-color: #dd965f; }
        .navigator li.mars::after           { content: "Mars"; }

        .navigator li.jupiter::before       { background-color: #e9c5a9; }
        .navigator li.jupiter::after        { content: "Jupiter"; }

        .navigator li.saturn::before        { background-color: #e0c092; }
        .navigator li.saturn::after         { content: "Saturn"; }

        .navigator li.uranus::before        { background-color: #b8f3fc; }
        .navigator li.uranus::after         { content: "Uranus"; }

        .navigator li.neptune::before       { background-color: #4289c6; }
        .navigator li.neptune::after        { content: "Neptune"; }

        .navigator li.pluto::before         { background-color: #947c6c; }
        .navigator li.pluto::after          { content: "Pluto"; }

        .navigator .legend {
            font-size: 13px;
            font-weight: 400;
            color: #ffffff55;
            text-transform: uppercase;
            letter-spacing: 0.2em;
        }

        @keyframes controller {
            0% { opacity: 0; transform: translateY(30px); }
            85% { opacity: 1; }
            100% { transform: translateY(0); }
        }

        @keyframes navigatorLeft {
            0% { opacity: 0; left: -100px; }
            85% { opacity: 1; }
            100% { left: 70px; }
        }

        @keyframes navigatorRight {
            0% { opacity: 0; right: -100px; }
            85% { opacity: 1; }
            100% { right: 70px; }
        }

        /* Navigation right changes
         ----------------------------------- */

        .navigator.right {
            top: 30%;
            left: auto;
            right: 70px;
            transform-origin: right center;
            animation-name: navigatorRight;
        }

        .navigator.right li::after {
            padding: 5px 30px 5px 5px;
            transform: translate(5px, -75px) rotate(90deg);
            text-align: right;
        }
        .navigator.right li:hover::after {
            transform: translate(5px, -100px) rotate(90deg);
        }

        /* Audioplayer
         ----------------------------------- */
        #audio {
            display: none;
        }

        .audio-player {
            position: absolute;
            right: 70px;
            bottom: 70px;
            display: flex;
            flex-wrap: wrap;
            align-items: center;
            animation: controller 2s both ease;
            animation-delay: .5s;
            animation-direction: normal;
            animation-iteration-count: 1;
        }

        .audio-player .title--holder {
            max-width: 15vw;
            width: 240px;
            margin: 0 30px 0 0;
            text-align: left;
            outline: none;
            border: none;
            overflow: hidden;
            -webkit-mask: linear-gradient(90deg, rgba(0,0,0,0) 0%, rgba(255,255,255,1) 10%, rgba(255,255,255,1) 90%, rgba(0,0,0,0) 100%);
            mask: linear-gradient(90deg, rgba(0,0,0,0) 0%, rgba(255,255,255,1) 10%, rgba(255,255,255,1) 90%, rgba(0,0,0,0) 100%);
        }

        .audio-player .title--holder > .title {
            width: min-content;
            padding: 0 10px;
            font-family: 'Inter', sans-serif;
            font-size: 16px;
            font-weight: 200;
            color: #ffffffdd;
            text-shadow: 0 0 6px #ffffff66;
            text-overflow: ellipsis;
            white-space: nowrap;
            overflow: hidden;
            transform: translateX(calc(-100% - 30px));
            animation-iteration-count: infinite;
            animation-timing-function: linear;
            animation-fill-mode: both;
            animation-play-state: paused;
            animation-delay: 0s;
            animation-duration: 20s;
            animation-direction: reverse;
            animation-name: movingTitle;
        }

        .audio-player.sound-on .title--holder > .title {
            animation-play-state: running;
        }

        .audio-player .play-pause,
        .audio-player .shuffle {
            width: 30px;
            height: 30px;
            margin-left: 10px;
            padding: 8px;
            border-radius: 4px;
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            align-items: center;
            cursor: pointer;
            gap: 4px;
            transition: all .3s ease;
        }

        .audio-player .play-pause:hover,
        .audio-player .shuffle:hover {
            background-color: #ffffff09;
        }

        .audio-player .play-pause > .bar {
            width: 2px;
            height: 24px;
            background-color: #fff;
            transform-origin: center;
            animation-iteration-count: infinite;
            animation-timing-function: ease-in-out;
            animation-fill-mode: forwards;
            animation-play-state: paused;
            animation-name: soundWave;
        }

        .audio-player .play-pause > .bar:nth-child(1) {
            transform: scaleY(0.33);
            animation-delay: 0.1s;
            animation-duration: 4s;
        }

        .audio-player .play-pause > .bar:nth-child(2) {
            transform: scaleY(0.7);
            animation-delay: 0.2s;
            animation-duration: 5s;
        }

        .audio-player .play-pause > .bar:nth-child(3) {
            transform: scaleY(0.46);
            animation-delay: 0.4s;
            animation-duration: 6s;
        }

        .audio-player.sound-on .play-pause > .bar {
            animation-play-state: running;
        }

        @keyframes soundWave {
            0% { transform: scaleY(1); }
            20% { transform: scaleY(.35); }
            40% { transform: scaleY(.65); }
            60% { transform: scaleY(.25); }
            80% { transform: scaleY(.80); }
            100% { transform: scaleY(1); }
        }

        .audio-player .shuffle img {
            width: 26px;
            height: 26px;
            animation-duration: 0.5s;
            animation-iteration-count: 1;
            animation-timing-function: ease-in-out;
            animation-fill-mode: both;
        }

        .audio-player .shuffle:hover img {
            animation-name: rotatingShuffle;
        }

        @keyframes movingTitle {
            0% { transform: translateX(calc(-100% - 30px)); }
            100% { transform: translateX(calc(+100% + 30px)); }
        }

        @keyframes rotatingShuffle {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(180deg); }
        }

        /* Loading
         ----------------------------------- */

        #canvas-container {
            transform: translateY(-25%);
        }

        #loader {
            display: flex;
            justify-content: center;
            align-items: center;
            position: fixed;
            left: 0;
            right: 0;
            bottom: 0;
            height: 100vh;
            background: linear-gradient(220deg, rgb(11 11 14) 0%, rgb(2 4 14) 100%);
            /* background: linear-gradient(220deg, rgb(11 11 14) 0%, rgb(2 4 14) 100%); */
            background-color: #131315;
            transition: all 2s cubic-bezier(0.67, 0.04, 0.18, 0.96);
            transition-delay: 0.25s;
            overflow: hidden;
            z-index: 100;
        }

        #loader .container {
            text-align: center;
            user-select: none;
            clip-path: polygon(0 0, 100% 0, 100% 100%, 0% 100%);
            transition: all 1.5s cubic-bezier(0.67, 0.04, 0.18, 0.96);
        }

        #loader .loading-text {
            font-size: 3.5vmin;
            font-weight: 400;
            letter-spacing: 0.1em;
            text-transform: uppercase;
            text-shadow: 0 0 4px #ffffff66;
            color: #fff;
        }

        #loader .loading-text-instructions {
            color: #ffffff52;
            font-size: 16px;
            font-weight: 300;
            margin-top: 24px;
            line-height: 2;
        }

        body.loaded #canvas-container {
            transform: translateY(0);
        }

        body.loaded #loader {
            height: 0;
            pointer-events: none;
        }

        body.loaded #loader .container {
            margin-top: 5vmax;
            transform: translateY(100%);
            clip-path: polygon(0 100%, 100% 100%, 100% 100%, 0% 100%);
        }


        /* Cursor
         ----------------------------------- */

        #canvas-container * {
            cursor: none;
        }

        #cursor {
            display: flex;
            justify-content: center;
            align-items: center;
            position: fixed;
            top: 50%;
            left: 50%;
            width: 16px;
            height: 16px;
            padding: 5px;
            border-radius: 40px;
            border: 1px solid #fff2;
            opacity: 0;
            transform: translate(-50%, -50%);
            transition: opacity 1s ease-in-out, padding .2s ease-in-out, border .2s ease-in-out;
            pointer-events: none;
        }

        #cursor::before {
            position: absolute;
            content: "";
            width: 2px;
            height: 2px;
            border-radius: 2px;
            background-color: #fff7;
            transition: background .2s ease-in-out;
        }

        #canvas-container:active #cursor {
            padding: 10px;
            border-color: transparent;
        }

        #canvas-container:active #cursor::before {
            background: transparent;
        }
    </style>
</head>
<body>

    <div id="loader">
        <div class="container">
            <div class="loading-text">Loading assets</div>
            <div class="loading-text-instructions">
                Use the mouse to navigate -
                <br/>Hide the user interface in the top right corner
            </div>
        </div>
    </div>

    <div class="story--holder" id="universe">
        <div id="canvas-container">
            <div id="cursor"></div>
            <div class="hide-ui"></div>
            <div class="body-information">

                <!-- Sun -->
                <article id="sun-information">
                    <div class="title">Sun â˜‰</div>
                    <dl class="information">
                        <dt>Radius</dt><dd>696,342 km</dd>
                        <dt>Rotation tilt</dt><dd>7.25Â°</dd>
                        <dt>Rotation speed</dt><dd>25 days 6 hours</dd>
                    </dl>
                </article>

                <!-- Mercury -->
                <article id="mercury-information">
                    <div class="title">Mercury â˜¿</div>
                    <dl class="information">
                        <dt>Diameter</dt><dd>4,880 km</dd>
                        <dt>Rotation tilt</dt><dd>0.034Â°</dd>
                        <dt>Rotation speed</dt><dd>58 days 15 hours</dd>
                    </dl>
                    <hr>
                    <dl class="information">
                        <dt>Orbital radius</dt><dd>0.3871 AE</dd>
                        <dt>Orbital tilt</dt><dd>7.0049Â°</dd>
                        <dt>Orbital speed</dt><dd>~ 47.36 km/s</dd>
                    </dl>
                </article>

                <!-- Venus -->
                <article id="venus-information">
                    <div class="title">Venus â™€</div>
                    <dl class="information">
                        <dt>Diameter</dt><dd>12,103.6 km</dd>
                        <dt>Rotation tilt</dt><dd>177.36Â°</dd>
                        <dt>Rotation speed</dt><dd>243 days 36 minutes</dd>
                    </dl>
                    <hr>
                    <dl class="information">
                        <dt>Orbital radius</dt><dd>0.723 AE</dd>
                        <dt>Orbital tilt</dt><dd>8.3947Â°</dd>
                        <dt>Orbital speed</dt><dd>~ 35.02 km/s</dd>
                    </dl>
                </article>

                <!-- Earth -->
                <article id="earth-information">
                    <div class="title">Earth ðŸœ¨</div>
                    <dl class="information">
                        <dt>Diameter</dt><dd>12,756.27 km</dd>
                        <dt>Rotation tilt</dt><dd>23.44Â°</dd>
                        <dt>Rotation speed</dt><dd>23 hours 56 minutes</dd>
                    </dl>
                    <hr>
                    <dl class="information">
                        <dt>Orbital radius</dt><dd>1 AE</dd>
                        <dt>Orbital tilt</dt><dd>0.0001Â°</dd>
                        <dt>Orbital speed</dt><dd>~ 29.78 km/s</dd>
                    </dl>
                </article>

                <!-- Mars -->
                <article id="mars-information">
                    <div class="title">Mars â™‚</div>
                    <dl class="information">
                        <dt>Diameter</dt><dd>6,792.4 km</dd>
                        <dt>Rotation tilt</dt><dd>25.19Â°</dd>
                        <dt>Rotation speed</dt><dd>24 hours 37 minutes</dd>
                    </dl>
                    <hr>
                    <dl class="information">
                        <dt>Orbital radius</dt><dd>1,524 AE</dd>
                        <dt>Orbital tilt</dt><dd>1.8506Â°</dd>
                        <dt>Orbital speed</dt><dd>~ 24.07 km/s</dd>
                    </dl>
                </article>

                <!-- Jupiter -->
                <article id="jupiter-information">
                    <div class="title">Jupiter â™ƒ</div>
                    <dl class="information">
                        <dt>Diameter</dt><dd>142,984 km</dd>
                        <dt>Rotation tilt</dt><dd>3.13Â°</dd>
                        <dt>Rotation speed</dt><dd>9 hours 55 minutes</dd>
                    </dl>
                    <hr>
                    <dl class="information">
                        <dt>Orbital radius</dt><dd>5.204 AE</dd>
                        <dt>Orbital tilt</dt><dd>1.304Â°</dd>
                        <dt>Orbital speed</dt><dd>~ 13.06 km/s</dd>
                    </dl>
                </article>

                <!-- Saturn -->
                <article id="saturn-information">
                    <div class="title">Saturn â™„</div>
                    <dl class="information">
                        <dt>Diameter</dt><dd>120,536 km</dd>
                        <dt>Rotation tilt</dt><dd>26.73Â°</dd>
                        <dt>Rotation speed</dt><dd>10 hours 33 minutes</dd>
                    </dl>
                    <hr>
                    <dl class="information">
                        <dt>Orbital radius</dt><dd>9.582 AE</dd>
                        <dt>Orbital tilt</dt><dd>2.4845Â°</dd>
                        <dt>Orbital speed</dt><dd>~ 9.68 km/s</dd>
                    </dl>
                </article>

                <!-- Uranus -->
                <article id="uranus-information">
                    <div class="title">Uranus â›¢</div>
                    <dl class="information">
                        <dt>Diameter</dt><dd>51,118 km</dd>
                        <dt>Rotation tilt</dt><dd>97.77Â°</dd>
                        <dt>Rotation speed</dt><dd>17 hours 14 minutes</dd>
                    </dl>
                    <hr>
                    <dl class="information">
                        <dt>Orbital radius</dt><dd>19.201 AE</dd>
                        <dt>Orbital tilt</dt><dd>0.7699Â°</dd>
                        <dt>Orbital speed</dt><dd>~ 6.81 km/s</dd>
                    </dl>
                </article>

                <!-- Neptune -->
                <article id="neptune-information">
                    <div class="title">Neptune â™†</div>
                    <dl class="information">
                        <dt>Diameter</dt><dd>49,528 km</dd>
                        <dt>Rotation tilt</dt><dd>28.32Â°</dd>
                        <dt>Rotation speed</dt><dd>15 hours 58 minutes</dd>
                    </dl>
                    <hr>
                    <dl class="information">
                        <dt>Orbital radius</dt><dd>30.047 AE</dd>
                        <dt>Orbital tilt</dt><dd>1.7692Â°</dd>
                        <dt>Orbital speed</dt><dd>~ 5.43 km/s</dd>
                    </dl>
                </article>

                <!-- Pluto -->
                <article id="pluto-information">
                    <div class="title">Pluto â™‡</div>
                    <dl class="information">
                        <dt>Diameter</dt><dd>2,374 km</dd>
                        <dt>Rotation tilt</dt><dd>122.53Â°</dd>
                        <dt>Rotation speed</dt><dd>6 days 9 hours 43 minutes</dd>
                    </dl>
                    <hr>
                    <dl class="information">
                        <dt>Orbital radius</dt><dd>39.482 AE</dd>
                        <dt>Orbital tilt</dt><dd>17.1418Â°</dd>
                        <dt>Orbital speed</dt><dd>~ 4.67 km/s</dd>
                    </dl>
                </article>
            </div>

            <!-- UI -->
            <div class="ui-holder">

                <!-- Controller -->
                <div class="controller days-passed">
                    <div class="value" id="days">0</div>
                    <div class="title">Days passed</div>
                </div>
                <div class="controller simulation-speed">
                    <form>
                        <input class="value" id="simulation-speed" type="number" value="0.02" />
                    </form>
                    <div class="title">Simulation speed</div>
                </div>

                <!-- Navigator left -->
                <div class="navigator">
                    <nav id="navigate-to">
                        <ul>
                            <li class="sun" data-body="sun"></li>
                            <li class="mercury" data-body="mercury"></li>
                            <li class="venus" data-body="venus"></li>
                            <li class="earth" data-body="earth"></li>
                            <li class="mars" data-body="mars"></li>
                            <li class="jupiter" data-body="jupiter"></li>
                            <li class="saturn" data-body="saturn"></li>
                            <li class="uranus" data-body="uranus"></li>
                            <li class="neptune" data-body="neptune"></li>
                            <li class="pluto" data-body="pluto"></li>
                        </ul>
                    </nav>
                    <div class="legend">Attach to</div>
                </div>

                <!-- Navigator right -->
                <div class="navigator right">
                    <nav id="look-at">
                        <ul>
                            <li class="sun active" data-body="sun"></li>
                            <li class="mercury" data-body="mercury"></li>
                            <li class="venus" data-body="venus"></li>
                            <li class="earth" data-body="earth"></li>
                            <li class="mars" data-body="mars"></li>
                            <li class="jupiter" data-body="jupiter"></li>
                            <li class="saturn" data-body="saturn"></li>
                            <li class="uranus" data-body="uranus"></li>
                            <li class="neptune" data-body="neptune"></li>
                            <li class="pluto" data-body="pluto"></li>
                        </ul>
                    </nav>
                    <div class="legend">Look at</div>
                </div>

                <!-- Audioplayer -->
                <div class="audio-player">
                    <div class="title--holder">
                        <div class="title">Uncharted Worlds</div>
                    </div>
                    <div class="play-pause" title="Play / pause music">
                        <div class="bar"></div>
                        <div class="bar"></div>
                        <div class="bar"></div>
                    </div>
                    <div class="shuffle" id="shuffle" title="Shuffle to another song">
                        <img src="img/shuffle.svg" alt="Shuffle" />
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="js/three.js"></script>
    <script src="js/jquery-3.5.1.min.js" type="text/javascript"></script>

    <script type="module">

        // import * as THREE from './js/three.js';
        import { OrbitControls } from './js/OrbitControls.js';

        var container;
        var camera, scene, renderer, controls, loader;
        var mouse, raycaster;
        var framesCount = 0;

        var ambientLight, pointLight;

        let particles = [],
            particle, geometry, material, particleMap, spriteMaterial;

        // Math variables
        const pi2 = Math.PI * 2; // full rotation
        const deg = Math.PI / 180; // one degree
        const sin1 = Math.PI / 2; // one sin
        const goldenAngle = Math.PI * (3 - Math.sqrt(5));

        // Math functions
        function easeInOut(x) {
            return Math.pow(Math.sin(x * Math.PI / 2), 2);
        }

        // Story variables
        let snapshotFrame;
        let snapshotCameraPosition = new THREE.Vector3();
        let snapshotCameraRotation = new THREE.Vector3();
        let storyTransition = false;
        let attached = false;
        let locked = true;

        /*
         * Solarsystem Documentation
         *
         * AE in km
         * body['radius'] in km
         * body['distance'] in km * AE
         * body['speed'] in km/s
         * body['rotationSpeed'] compared times to earth
         * body['tilt'] in deg
         * orbital['tilt'] in deg
         *
        */

        // Objects
        let body, bodyGeometry, bodyMaterial, bodies = [], gBodies = [];
        let atmosphere, atmosphereGeometry, atmosphereMaterial, atmospheres = [];
        let rings, ringsGeometry, ringsMaterial;
        let orbit, orbitGeometry, orbitMaterial, orbits = [];

        // Simulation
        let simulationMode          = true;
        let milliseconds            = 0;
        let daysInSimulationPast    = 0;
        let simulationSpeed         = window.simulationSpeed = 0.02;
        const updateDateEvent       = new Event('updateDate');

        // Variables
        const AE    = 149597870;
        const km    = 1 / 1000;
        const year  = 365;
        const day   = 1 / year;
        const fps   = 60;
        const scale = 50;
        const solarsystem = {
            "sun": {
                "orbital": {
                    "tilt": 0
                },
                "body": {
                    // "radius": 696342.00,
                    "radius": 150000.00,
                    "distance": 0,
                    "speed": 0,
                    "rotationSpeed": 0.04,
                    "tilt": 7.25,
                    "color": "#ffbc76",
                    "map": "sun.jpg"
                }
            },
            "mercury": {
                "orbital": {
                    "tilt": 7.0049
                },
                "body": {
                    "radius": 4880.00,
                    "distance": 0.3871,
                    "speed": 47.36,
                    "rotationSpeed": 0.017,
                    "tilt": 0.034,
                    "color": "#e3d9c7",
                    "map": "mercury.jpg"
                },
                "atmosphere": false
            },
            "venus": {
                "orbital": {
                    "tilt": 8.3947,
                },
                "body": {
                    "radius": 6501.65,
                    "distance": 0.723,
                    "speed": 35.02,
                    "rotationSpeed": 0.004,
                    "tilt": 177.36,
                    "color": "#eac9b0",
                    "map": "venus.jpg"
                },
                "atmosphere": {
                    "elevation": 1.025,
                    "opacity": 0.9,
                    "blending": 1,
                    "rotationMultiplicator": 120,
                    "map": "venus_atmosphere.jpg"
                }
            },
            "earth": {
                "orbital": {
                    "tilt": 0.0001,
                },
                "body": {
                    "radius": 6378.135,
                    "distance": 1,
                    "speed": 29.78,
                    "rotationSpeed": 1,
                    "tilt": 23.44,
                    "color": "#5f9bd9",
                    "map": "earth.jpg"
                },
                "atmosphere": {
                    "elevation": 1.025,
                    "opacity": 1,
                    "blending": 1,
                    "rotationMultiplicator": 1.1,
                    "map": "earth_atmosphere.png"
                }
            },
            "mars": {
                "orbital": {
                    "tilt": 1.8506,
                },
                "body": {
                    "radius": 3396.2,
                    "distance": 1.524,
                    "speed": 24.07,
                    "rotationSpeed": 0.999,
                    "tilt": 25.19,
                    "color": "#dd965f",
                    "map": "mars.jpg"
                },
                "atmosphere": {
                    "elevation": 1.025
                }
            },
            "jupiter": {
                "orbital": {
                    "tilt": 1.304,
                },
                "body": {
                    "radius": 71492.0,
                    "distance": 5.204,
                    "speed": 13.06,
                    "rotationSpeed": 2.4,
                    "tilt": 3.13,
                    "color": "#e9c5a9",
                    "map": "jupiter.jpg"
                },
                "atmosphere": {
                    "elevation": 1.05
                }
            },
            "saturn": {
                "orbital": {
                    "tilt": 2.4845,
                },
                "body": {
                    "radius": 60268.0,
                    "distance": 9.582,
                    "speed": 9.68,
                    "rotationSpeed": 2.285,
                    "tilt": 26.73,
                    "color": "#e0c092",
                    "map": "saturn.jpg"
                },
                "atmosphere": {
                    "elevation": 1.05
                },
                "rings": {
                    // not real sizes,
                    "innerRadius": 67000,
                    "outerRadius": 160000,
                    "map": "saturn-rings.png"
                }
            },
            "uranus": {
                "orbital": {
                    "tilt": 0.7699,
                },
                "body": {
                    "radius": 25559.0,
                    "distance": 19.201,
                    "speed": 6.81,
                    "rotationSpeed": 1.411,
                    "tilt": 97.77,
                    "color": "#b8f3fc",
                    "map": "uranus.jpg"
                },
                "atmosphere": {
                    "elevation": 1.05
                }
            },
            "neptune": {
                "orbital": {
                    "tilt": 1.7692,
                },
                "body": {
                    "radius": 24764.0,
                    "distance": 30.047,
                    "speed": 5.43,
                    "rotationSpeed": 1.5,
                    "tilt": 28.32,
                    "color": "#4289c6",
                    "map": "neptune.jpg"
                },
                "atmosphere": {
                    "elevation": 1.05
                }
            },
            "pluto": {
                "orbital": {
                    "tilt": 17.1418,
                },
                "body": {
                    "radius": 1187.0,
                    "distance": 39.482,
                    "speed": 4.67,
                    "rotationSpeed": 0.166,
                    "tilt": 122.53,
                    "color": "#947c6c",
                    "map": "pluto.jpg"
                },
                "atmosphere": {
                    "elevation": 1.05
                }
            }
        };

        init();
        sceneAnimation();

        // Initiating Scene
        function init() {

            // INIT Scene
            // --------------------------------------

            scene = new THREE.Scene();

            // INIT Camera
            // --------------------------------------

            camera = new THREE.PerspectiveCamera(50, window.innerWidth / window.innerHeight, 0.01, 1000000);
            camera.position.set(-2000, 1000, -1000);

            // INIT Renderer
            // --------------------------------------

            renderer = new THREE.WebGLRenderer({ antialias: true });
            renderer.setPixelRatio(window.devicePixelRatio);
            renderer.setSize(window.innerWidth, window.innerHeight);
            renderer.shadowMap.enabled = true;
            renderer.shadowMap.type = THREE.PCFSoftShadowMap;

            if (simulationMode !== true) {
                renderer.setClearColor('#080810');
            }

            container = document.getElementById('canvas-container');
            container.appendChild(renderer.domElement);

            raycaster = new THREE.Raycaster();
            mouse = new THREE.Vector2();

            // INIT LOADER
            // --------------------------------------
            loader = new THREE.TextureLoader();

            // INIT Options
            // --------------------------------------

            // Lights
            addLights();

            // Controls
            addControls();

            // Create celestial bodies
            sceneCelestialBodies();

            // Create glow around sun
            sceneSunshine(solarsystem['sun']);

            // Create particles
            sceneStars();

            // Update renderer and camera when resizing
            window.addEventListener('resize', onWindowResize, false);
            window.addEventListener('mousemove', mouseVectoring, false);
            window.addEventListener('click', function() { intersectClick(bodies); }, false);
            // window.addEventListener('dblclick', function() { intersectDblClick(bodies); }, false);

            // Grid
            // helperGrid();

            // INIT Story
            // --------------------------------------

            window.daysInSimulationPast = daysInSimulationPast;
            window.simulationNavigate = '';
            window.simulationLookAt = 'sun';

            // Attach Trigger
            document.addEventListener('navigatorAttach', function() {
                attached = false;
                storyTriggerRewrites();
            }, false);

            // Detach Trigger
            document.addEventListener('navigatorDetachEvent', function() {
                storyTransition = false;
                attached = false;
            }, false);

            // Look At Trigger
            document.addEventListener('navigatorLookAt', function() {
                locked = false;
                storyTriggerRewrites();
            }, false);

            // Rendered Trigger
            document.addEventListener('renderedObjects', function() {
                for (let i = 0; i < orbits.length; ++i) {
                    orbits[i].rotation.y = THREE.MathUtils.randFloatSpread(180) * deg; // randomize initial placement
                }
            });

        }


        // Rendering the scene
        function sceneAnimation() {
            requestAnimationFrame(sceneAnimation);
            scene.updateMatrixWorld();

            // Counting
            framesCount++; milliseconds++;

            // if one second (times the simulation speed) has passed
            if ((milliseconds * window.simulationSpeed) / fps >= 1) {

                // Update days count
                daysInSimulationPast++;
                window.daysInSimulationPast = daysInSimulationPast;
                document.dispatchEvent(updateDateEvent);

                // Reset milliseconds
                milliseconds = 0;
            }

            /* Stars Animation
             * ------------------------------ */
            for (let i = 0; i < particles.length; ++i) {
                particles[i].material.opacity = (Math.sin((i + framesCount) * 0.02)) + 1.35;
            }


            /* Single Orbit Animation
             * ------------------------------ */
            for (let i = 0; i < orbits.length; ++i) {
                let key = Object.keys(solarsystem)[i];
                let o = solarsystem[key];

                // If orbit around center exists
                if (o.body.distance > 0) {
                    let radius = o.body.distance * AE;
                    let circum = radius * Math.PI * 2;
                    let traveledPerDay = o.body.speed * 60 * 60 * 24;

                    orbits[i].rotation.x = solarsystem[key].orbital.tilt * deg;
                    orbits[i].rotation.y += (pi2 / circum * traveledPerDay) / fps * window.simulationSpeed;
                }
            }

            /* Group Body Counter Rotation
             * so body isn't tidal locked
             * ------------------------------ */
            for (let i = 0; i < gBodies.length; ++i) {
                let key = Object.keys(solarsystem)[i];
                let o = solarsystem[key];

                if (i !== 0) {
                    let radius = o.body.distance * AE;
                    let circum = radius * Math.PI * 2;
                    let traveledPerDay = o.body.speed * 60 * 60 * 24;

                    gBodies[i].rotation.y -= (pi2 / circum * traveledPerDay) / fps * window.simulationSpeed;
                }
            }

            /* Body Rotation
             * ------------------------------ */
            for (let i = 0; i < bodies.length; ++i) {
                let key = Object.keys(solarsystem)[i];
                let o = solarsystem[key];

                bodies[i].rotation.y += pi2 * o.body.rotationSpeed / fps * window.simulationSpeed;

                // Atmosphere rotation
                if (atmospheres[i] && o.atmosphere.rotationMultiplicator) {
                    atmospheres[i].rotation.y += pi2 * o.body.rotationSpeed / fps * window.simulationSpeed * o.atmosphere.rotationMultiplicator;
                }
            }

            /* Story Animations
             * ------------------------------ */
            if (storyTransition === true) {
                bodies.forEach(function(body) {
                    if (body.name === window.simulationNavigate) {
                        storyAnimateCameraPosition(body, framesCount, snapshotFrame, snapshotCameraPosition, 100);
                    }
                    if (body.name === window.simulationLookAt) {
                        storyAnimateCameraRotation(body, framesCount, snapshotFrame, snapshotCameraRotation, 100);
                    }
                });
            }

            renderer.render(scene, camera);
        }

        function addControls() {
            controls = new OrbitControls(camera, renderer.domElement);
            controls.screenSpacePanning = true;
            controls.panSpeed = 0.5;
            controls.minDistance = 0;
            controls.maxDistance = 450000;
            controls.target.set(0, 0, 0);
            controls.update();
        }

        function sceneCelestialBodies() {
            const s = solarsystem;
            const sCount = Object.keys(s).length;

            for (let i = 0; i < sCount; i++) {

                /* Create groups
                 * ------------------------------ */
                let gOrbit = new THREE.Group();
                let gBody  = new THREE.Group();

                // Current body
                const key = Object.keys(s)[i];
                const o   = s[key];
                const distance = o.body.distance * AE * km / scale;
                const imageFolder = (simulationMode === true) ? 'img/highres/' : 'img/';



                /* Create body
                 * ------------------------------ */
                if (key !== 'sun') {
                    bodyMaterial = new THREE.MeshLambertMaterial({map: loader.load(imageFolder + o.body.map), color: o.body.color});
                } else {
                    bodyMaterial = new THREE.MeshBasicMaterial({map: loader.load(imageFolder + o.body.map), color: o.body.color});
                }

                bodyGeometry        = new THREE.SphereBufferGeometry(o.body.radius * km, 64, 64);
                body = bodies[i]    = new THREE.Mesh(bodyGeometry, bodyMaterial);

                // Tilt
                body.rotation.x = o.body.tilt * deg;

                // Add to local group
                body.name = key;
                gBody.add(body);



                /* Create atmosphere
                 * ------------------------------ */
                if (o.atmosphere) {
                    atmosphereGeometry  = new THREE.SphereBufferGeometry(o.body.radius * km * o.atmosphere.elevation, 64, 64);
                    atmosphereMaterial  = new THREE.MeshLambertMaterial({color: o.body.color, transparent: true});
                    atmosphere = atmospheres[i] = new THREE.Mesh(atmosphereGeometry, atmosphereMaterial);

                    // if has texture : add to material
                    if (o.atmosphere.map) {
                        atmosphere.material.map = loader.load(imageFolder + o.atmosphere.map);
                    }

                    // if simulation mode is activated
                    if (simulationMode === true) {

                        // apply real data if available
                        if (o.atmosphere.map && o.atmosphere.opacity && o.atmosphere.blending) {
                            atmosphere.material.blending = o.atmosphere.blending;
                            atmosphere.material.opacity = o.atmosphere.opacity;
                        } else {
                            atmosphere.material.blending = 2;
                            atmosphere.material.opacity = 0.15;
                        }
                    } else {
                        atmosphere.material.blending = 2;
                        atmosphere.material.opacity = 1;
                    }

                    // Tilt
                    atmosphere.rotation.x = o.body.tilt * deg;

                    // Name and add to local group
                    atmosphere.name = key + '-atmosphere';
                    gBody.add(atmosphere);
                }



                /* Create rings
                 * ------------------------------ */
                if (o.rings) {
                    ringsGeometry   = new THREE.RingBufferGeometry(o.rings.innerRadius * km, o.rings.outerRadius * km, 64, 64);
                    ringsMaterial   = new THREE.MeshLambertMaterial({map: loader.load('img/' + o.rings.map), transparent: true, side: THREE.DoubleSide});
                    rings           = new THREE.Mesh(ringsGeometry, ringsMaterial);

                    // Tilt
                    rings.rotation.x = (o.body.tilt + 90) * deg;

                    // Name and add to local group
                    rings.name = key + '-rings';
                    gBody.add(rings);
                }



                /* Create orbit
                 * ------------------------------ */
                if (o.orbital && simulationMode !== true) {
                    orbitGeometry   = new THREE.TorusGeometry(distance, 0.3, 32, 100);
                    orbitMaterial   = new THREE.MeshBasicMaterial({color: 0xffffff, transparent: true, opacity: 0.1});
                    orbit           = new THREE.Mesh(orbitGeometry, orbitMaterial);

                    orbit.rotation.x = 90 * deg;
                }



                /* Refine body group
                 * ------------------------------ */
                gBody.name = key + '-group';
                gBody.position.x = distance; // distance from center
                gBody.rotation.x = o.body.tilt * deg; // tilt towards center
                gBody.rotation.y = THREE.MathUtils.randFloatSpread(180) * deg; // randomize inital rotation
                gBodies[i] = gBody;



                /* Define orbit group
                 * ------------------------------ */
                gOrbit.name = key + '-orbit';
                // gOrbit.rotation.y = THREE.MathUtils.randFloatSpread(180) * deg; // randomize initial placement
                gOrbit.add(orbit);
                gOrbit.add(gBody);
                orbits[i] = gOrbit;

                // Add orbit group to solarsystem group and scene
                scene.add(gOrbit);
            }
        }

        function sceneSunshine(obj) {
            var sunshineMap       = new THREE.TextureLoader().load("img/sunshine_sprite.svg");
            var sunshineMaterial  = new THREE.SpriteMaterial({ map: sunshineMap });
            var sunshine          = new THREE.Sprite(sunshineMaterial);
            sunshine.scale.x = obj.body.radius / 333;
            sunshine.scale.y = obj.body.radius / 333;
            sunshine.scale.z = obj.body.radius / 333;
            sunshine.material.opacity = 0.66;
            scene.add(sunshine);
        }

        function sceneStars(isSprite = true, size = 24, length = 3200, minDistance = 80000, maxDistance = 320000) {

            // Init
            geometry    = new THREE.SphereBufferGeometry(size, 8, 8);
            particleMap = new THREE.TextureLoader().load("img/star_sprite.svg");

            let i = 0;

            for (i; i < length; ++i) {

                // Is sprite (better performance)
                if (isSprite === true) {
                    spriteMaterial = new THREE.SpriteMaterial({ map: particleMap });
                    particle = particles[i] = new THREE.Sprite(spriteMaterial);
                    particle.scale.set(85, 85, 85);

                // Is 3d stars
                } else {
                    material = new THREE.MeshBasicMaterial({ color: "hsl(0, 100%, 100%)" });
                    particle = particles[i] = new THREE.Mesh(geometry, material);
                    particle.material.transparent = true;
                }

                // Distribute randomly with space in the middle
                let theta = goldenAngle * i;

                particle.position.x = THREE.MathUtils.randFloat(minDistance, maxDistance) * THREE.MathUtils.randFloatSpread(2) * Math.sin(theta);
                particle.position.y = THREE.MathUtils.randFloat(minDistance, maxDistance) * THREE.MathUtils.randFloatSpread(2) * Math.cos(theta);
                particle.position.z = THREE.MathUtils.randFloat(minDistance, maxDistance) * THREE.MathUtils.randFloatSpread(2);

                // At least one coordinate needs min-distance
                if (Math.random() < 0.33) {
                    particle.position.x = (particle.position.x < 0) ? particle.position.x - minDistance : particle.position.x + minDistance;
                } else if (Math.random() < 0.66) {
                    particle.position.y = (particle.position.y < 0) ? particle.position.y - minDistance : particle.position.y + minDistance;
                } else {
                    particle.position.z = (particle.position.z < 0) ? particle.position.z - minDistance : particle.position.z + minDistance;
                }

                scene.add(particle);
            }
        }


        // Camera
        function onWindowResize() {
            camera.aspect = window.innerWidth / window.innerHeight;
            camera.updateProjectionMatrix();
            renderer.setSize(window.innerWidth, window.innerHeight);
        }

        // Lights
        function addLights() {
            if (simulationMode === true) {
                ambientLight = new THREE.AmbientLight(0xffffff, 0);
                scene.add(ambientLight);
            } else {
                ambientLight = new THREE.AmbientLight(0xffffff, 0.05);
                scene.add(ambientLight);
            }

            pointLight = new THREE.PointLight(0xffffff, 0.66, 200000, 0.5);
            pointLight.position.set(0, 0, 0);
            pointLight.castShadow = true;
            pointLight.shadow.mapSize.width = 2048;
            pointLight.shadow.mapSize.height = 2048;
            scene.add(pointLight);
        }

        // Helpers
        function helperGrid() {
            var grid = new THREE.GridHelper(1000, 0);
            scene.add(grid);
        }

        
        // Raycasting (find intersecting elements)
        // -----------------------------------
        function mouseVectoring(e) {
            mouse.x = (e.clientX / window.innerWidth) * 2 - 1;
            mouse.y = - (e.clientY / window.innerHeight) * 2 + 1;
        }

        function rayCastingObjs(objs) {
            raycaster.setFromCamera(mouse, camera);
            return raycaster.intersectObjects(objs);
        }

        function intersectClick(objs) {
            var intersects = rayCastingObjs(objs);

            if (intersects.length > 0) {
                let clickBodyEvent = new CustomEvent('clickBody', { detail: { 'body': intersects[0].object.name } });
                document.dispatchEvent(clickBodyEvent);
            }
        }

        /* not functional
        function intersectDblClick(objs) {
            var intersects = rayCastingObjs(objs);

            if (intersects.length > 0) {
                storyAnimateCameraRotation(intersects[0].object, framesCount, snapshotFrame, snapshotCameraRotation, 100);
            }
        }
        */



        // Story

        // Get current status and write to story (general)
        function storyTriggerRewrites() {

            // Get current status on trigger
            storyTransition = true;
            snapshotFrame = framesCount;
            snapshotCameraPosition.x = camera.position.x;
            snapshotCameraPosition.y = camera.position.y;
            snapshotCameraPosition.z = camera.position.z;
            snapshotCameraRotation.x = camera.rotation.x;
            snapshotCameraRotation.y = camera.rotation.y;
            snapshotCameraRotation.z = camera.rotation.z;
        }

        function storyAnimateCameraPosition(target, framesCount, snapshotFrame, snapshotCameraPosition, countTo) {
            let current = camera.position;
            let v = new THREE.Vector3();
            let t = target.getWorldPosition(v);
            let s = snapshotCameraPosition;
            let r = target.geometry.parameters.radius;

            // Approach 0 to 1 with ease-in-out function in y frames
            let x = (framesCount - snapshotFrame) / countTo;
            let progress = easeInOut(x);

            // Define multiplications for elevated view of body
            let multiplicator = new THREE.Vector3(2.5, 2.5, 5);

            // Get if position is positive or negative
            let elevation = new THREE.Vector3();
            elevation.x = (current.x > 0) ? 1 : -1;
            elevation.y = 1;
            elevation.z = (current.z > 0) ? -1 : 1;

            // Attach if progress is completed
            if (attached === true) {
                current.x = t.x + (elevation.x * r * multiplicator.x);
                current.y = t.y + (elevation.y * r * multiplicator.y);
                current.z = t.z + (elevation.z * r * multiplicator.z);
            } else {

                // Set to "attached"
                if (x >= 1) {
                    attached = true;

                    // Slowly navigate to body
                } else {
                    current.x = s.x + ((t.x + (elevation.x * r * multiplicator.x) - s.x) * progress);
                    current.y = s.y + ((t.y + (elevation.y * r * multiplicator.y) - s.y) * progress);
                    current.z = s.z + ((t.z + (elevation.z * r * multiplicator.z) - s.z) * progress);
                }
            }

        }

        function storyAnimateCameraRotation(target, framesCount, snapshotFrame, snapshotCameraRotation, countTo) {
            let current = camera.rotation;
            let v = new THREE.Vector3();
            let t = target.getWorldPosition(v);
            let s = snapshotCameraRotation;

            // Approach 0 to 1 with ease-in-out function in y frames
            let x = (framesCount - snapshotFrame) / countTo;
            let progress = easeInOut(x);

            // Lock if progress is completed
            if (locked === true) {
                camera.lookAt(
                    current.x = t.x,
                    current.y = t.y,
                    current.z = t.z
                );
            } else {

                // Set to "locked"
                if (x >= 1) {
                    locked = true;

                // Slowly look at body
                } else {
                    camera.lookAt(
                        current.x = s.x + ((t.x - s.x) * progress),
                        current.y = s.y + ((t.y - s.y) * progress),
                        current.z = s.z + ((t.z - s.z) * progress)
                    );
                }
            }

            // Lock controls to fixated body
            controls.target.set(t.x, t.y, t.z);
        }

    </script>

    <script>

        $(document).ready(function() {

            const $body         = $('body');

            // Audioplayer
            // ----------------------------------

            const $audioPlayer  = $('.audio-player');
            const $titleHolder  = $('.audio-player .title--holder');
            const $play         = $('.audio-player .play-pause');
            const songs         = [
                {
                    "name": "Mass Effect - Uncharted Worlds",
                    "file": "audio/mass_effect_uncharted_worlds.mp3"
                },
                {
                    "name": "Mass Effect Andromeda - Galaxy Map",
                    "file": "audio/mass_effect_andromeda_galaxy_map.mp3"
                },
                {
                    "name": "Sarah, The Illstrumentalist - Stars and Constellations",
                    "file": "audio/sarah_the_illstrumentalist_stars_and_constellations.mp3"
                },
                {
                    "name": "Endless Space - The Endless",
                    "file": "audio/endless_space_the_endless.mp3"
                },
                {
                    "name": "Endless Space - Beneath The Strings",
                    "file": "audio/endless_space_beneath_the_strings.mp3"
                },
                {
                    "name": "Endless Space - TransX",
                    "file": "audio/endless_space_transx.mp3"
                },
                {
                    "name": "Endless Space - B.Matter",
                    "file": "audio/endless_space_bmatter.mp3"
                },
                {
                    "name": "Endless Space - Falling Night Stars",
                    "file": "audio/endless_space_falling_night_stars.mp3"
                },
                {
                    "name": "Metroid Prime 2 - Submerged Temple",
                    "file": "audio/metroid_prime_2_submerged_temple.mp3"
                },
                {
                    "name": "Metroid Prime 3 - Skytown",
                    "file": "audio/metroid_prime_3_skytown.mp3"
                },
                {
                    "name": "Perturbator - Last Kiss",
                    "file": "audio/perturbator_last_kiss.mp3"
                },
                {
                    "name": "Perturbator - The Price Of Failure",
                    "file": "audio/perturbator_the_price_of_failure.mp3"
                },
                {
                    "name": "Oliver Patrice Weder - Minutes and Hours",
                    "file": "audio/oliver_patrice_weder_minutes_and_hours.mp3"
                },
                {
                    "name": "Interstellar - A Place Among The Stars",
                    "file": "audio/interstellar_a_place_among_the_stars.mp3"
                },
                {
                    "name": "Interstellar - Message From Home",
                    "file": "audio/interstellar_message_from_home.mp3"
                },
                {
                    "name": "Interstellar - Cornfield Chase",
                    "file": "audio/interstellar_cornfield_chase.mp3"
                },
                {
                    "name": "Bonjr - It's Ok, You're Ok",
                    "file": "audio/bonjr_its_ok_youre_ok.mp3"
                }
            ];

            // Shuffle
            generateAudio();

            $('#shuffle').on('click', function() {
                generateAudio();
                playAudio();
            });

            function generateAudio() {
                let randomSong = songs[Math.floor(Math.random() * songs.length)];
                let name = randomSong.name;
                let file = randomSong.file;
                const audioElement = '<audio controls autoplay loop id="audio">' +
                                        '<source src="' + file + '" type="audio/mpeg">' +
                                     '</audio>';

                // Remove old audio & append new
                $titleHolder.find('.title').text(name);
                $body.find('audio').remove();
                $body.append(audioElement);
                document.getElementById('audio').volume = 0.2;
            }


            // Play / Pause
            $play.on('click', function() {
                playPause();
            });

            $(window).on('keydown', function(e) {
                if (e.keyCode === 32 || e.key === ' ') {
                    playPause();
                }
            });

            function playAudio() {
                $audioPlayer.addClass('sound-on');
                $body.find('audio').trigger('play');
            }

            function pauseAudio() {
                $audioPlayer.removeClass('sound-on');
                $body.find('audio').trigger('pause');
            }

            function playPause() {
                let soundOn = $audioPlayer.hasClass('sound-on');

                if (!soundOn) {
                    playAudio();
                } else {
                    pauseAudio();
                }
            }



            // Preload earth image (fairly large)
            // ----------------------------------

            const renderedObjectsEvent = new Event('renderedObjects');
            let image1 = new Image();
            image1.src = 'img/highres/earth.jpg';
            image1.onload = function() {

                // Reveal canvas
                console.log('Get ready to explore our solarsystem!');
                $('body').addClass('loaded');
                document.dispatchEvent(renderedObjectsEvent);
            }



            // Simulation
            // ----------------------------------

            document.addEventListener('updateDate', updateDate, false);

            const $daysPast = $('#days');
            const $simulationSpeed = $('#simulation-speed');

            function updateDate() {
                $daysPast.text(window.daysInSimulationPast);
            }

            $simulationSpeed.on('change keydown', function() {
                window.simulationSpeed = $(this).val();
            });



            // UI
            // ----------------------------------
            const $hideUI   = $('.hide-ui');
            const $uiHolder = $('.ui-holder');

            $hideUI.on('mouseenter', function() {
                $uiHolder.toggleClass('hidden');
            });


            const $cursor   = $('#cursor');

            $(window).on('mousemove', function(e) {
                placeCursor(e);
            });

            function placeCursor(e) {
                $cursor.css('top', e.pageY);
                $cursor.css('left', e.pageX);
                $cursor.css('opacity', 1);
            }



            // Navigator
            // ----------------------------------

            const navigatorAttachEvent = new Event('navigatorAttach');
            const navigatorDetachEvent = new Event('navigatorDetach');
            const navigatorLookAtEvent = new Event('navigatorLookAt');
            const $navigateItem = $('#navigate-to li');
            const $lookAtItem = $('#look-at li');

            $navigateItem.on('click', function() {
                const $this = $(this);

                // Detach
                if ($this.hasClass('active')) {
                    storyTransition = false;
                    $navigateItem.removeClass('active');
                    window.simulationNavigate = '';
                    document.dispatchEvent(navigatorDetachEvent);

                // Attach
                } else {
                    $navigateItem.removeClass('active');
                    $this.addClass('active');
                    window.simulationNavigate = $this.attr('data-body');
                    document.dispatchEvent(navigatorAttachEvent);
                }
            });

            $lookAtItem.on('click', function() {
                const $this = $(this);

                $lookAtItem.removeClass('active');
                $this.addClass('active');
                window.simulationLookAt = $this.attr('data-body');
                document.dispatchEvent(navigatorLookAtEvent);
            });



            // Body information
            // ----------------------------------

            const $bodyInformation = $('.body-information');
            let $bodyInformations = $bodyInformation.find('article');

            document.addEventListener('click', hideBodyInformation, false);
            document.addEventListener('clickBody', function(e) { showBodyInformation(e) }, false);

            function showBodyInformation(e) {
                $bodyInformation.find('#' + e.detail.body + '-information').addClass('active');
            }

            function hideBodyInformation() {
                $bodyInformations.removeClass('active');
            }
        });
    </script>

</body>
</html>